<!DOCTYPE html>
<html lang=en>
	<head>
		<meta charset=utf-8>
		<meta name="author" content="Genesis">
		<title>NativeComponent Behavior Example</title>
		<script src="https://cdn.rawgit.com/mrdoob/three.js/r84/build/three.min.js"></script>
		<script src="https://cdn.rawgit.com/AltspaceVR/AltspaceSDK/v2.1.0/dist/altspace.min.js"></script>
		<script src="../js/NativeComponent.js"></script>
	</head>
	<body>
		<script>
		var sim = new altspace.utilities.Simulation();

		altspace.getEnclosure().then(function(enclosure) {
			enclosure.requestFullspace().then(function() {
				// n-layout-browser (3D Enclosure)
				var nlayoutbrowser = new THREE.Mesh(new THREE.BoxBufferGeometry(5, 5, 5), Object.assign(new THREE.MeshBasicMaterial(), { visible: false }));
				nlayoutbrowser.position.set(15, 0, -15);
				nlayoutbrowser.scale.set(5, 5, 5);
				sim.scene.add(nlayoutbrowser);
				nlayoutbrowser.addBehaviors(
					new altspaceutil.behaviors.NativeComponent('n-layout-browser', { url: 'UserEvents.html', isEnclosure: true }),
					new altspaceutil.behaviors.NativeComponent('n-text', { text: 'n-layout-browser\n3D Enclosure', height: 6, fontSize: 4, verticalAlign: 'top' })
				);

				// n-layout-browser (2D Enclosure)
				var nlayoutbrowser = new THREE.Mesh(new THREE.BoxBufferGeometry(5, 5, 5), Object.assign(new THREE.MeshBasicMaterial({ color: 0xccdd33, transparent: true, opacity: 0.2 }), { visible: false }));
				nlayoutbrowser.position.set(-15, 0, -15);
				nlayoutbrowser.scale.set(5, 5, 5);
				sim.scene.add(nlayoutbrowser);
				nlayoutbrowser.addBehaviors(
					new altspaceutil.behaviors.NativeComponent('n-layout-browser', { url: 'https://google.com' }),
					new altspaceutil.behaviors.NativeComponent('n-text', { text: 'n-layout-browser\n2D Enclosure', height: 6, fontSize: 4, verticalAlign: 'top' })
				);

				// n-sphere-collider
				var nspherecollider = new THREE.Mesh(new THREE.SphereBufferGeometry(1, 8, 8), new THREE.MeshBasicMaterial({ color: 0x00ff00 }));
				nspherecollider.position.set(-10, 0, 0);
				sim.scene.add(nspherecollider);
				nspherecollider.addBehaviors(new altspaceutil.behaviors.NativeComponent('n-sphere-collider', { radius: 1 }), new altspaceutil.behaviors.NativeComponent('n-text', { text: 'n-sphere-collider', height: 4, fontSize: 4, verticalAlign: 'top' }));

				// n-box-collider
				var nboxcollider = new THREE.Mesh(new THREE.BoxBufferGeometry(2, 2, 2), new THREE.MeshBasicMaterial({ color: 0xff0000 }));
				nboxcollider.position.set(-5, 0, 0);
				sim.scene.add(nboxcollider);
				nboxcollider.addBehaviors(
					new altspaceutil.behaviors.NativeComponent('n-box-collider', { size: { x: 1, y: 1, z: 1 } }),
					new altspaceutil.behaviors.NativeComponent('n-text', { text: 'n-box-collider', height: 4, fontSize: 4, verticalAlign: 'top' })
				);

				// n-capsule-collider
				var ncapsulecollider = new THREE.Mesh(new THREE.CylinderBufferGeometry(1, 1, 2, 10), new THREE.MeshBasicMaterial({ color: 0xaaaa00 }));
				ncapsulecollider.position.set(0, 0, 0);
				sim.scene.add(ncapsulecollider);
				ncapsulecollider.addBehaviors(
					new altspaceutil.behaviors.NativeComponent('n-capsule-collider', { radius: 1, height: 2, direction: 'y' }),
					new altspaceutil.behaviors.NativeComponent('n-text', { text: 'n-capsule-collider', height: 4, fontSize: 4, verticalAlign: 'top' })
				);

				// n-mesh-collider
				var nmeshcollider = new THREE.Mesh(new THREE.TorusKnotBufferGeometry(2, 0.2, 64, 16), new THREE.MeshBasicMaterial({ color: 0x00aaaa }));
				nmeshcollider.position.set(5, 0, 0);
				sim.scene.add(nmeshcollider);
				nmeshcollider.addBehaviors(
					new altspaceutil.behaviors.NativeComponent('n-mesh-collider', { convex: false, type: 'environment' }),
					new altspaceutil.behaviors.NativeComponent('n-text', { text: 'n-mesh-collider', height: 4, fontSize: 4, verticalAlign: 'top' })
				);

				// n-spawner
				var nspawner = new THREE.Group();
				nspawner.position.set(-10, 0, 5);
				sim.scene.add(nspawner);
				nspawner.addBehaviors(
					new altspaceutil.behaviors.NativeComponent('n-spawner', { res: 'interactables/basketball' }),
					new altspaceutil.behaviors.NativeComponent('n-text', { text: 'n-spawner', height: 4, fontSize: 4, verticalAlign: 'top' })
				);

				// n-object
				var nobject = new THREE.Group();
				nobject.position.set(-5, 0, 5);
				sim.scene.add(nobject);
				nobject.addBehaviors(
					new altspaceutil.behaviors.NativeComponent('n-object', { res: 'objects/target-archery' }),
					new altspaceutil.behaviors.NativeComponent('n-object', { res: 'effects/fireworks' }),
					new altspaceutil.behaviors.NativeComponent('n-text', { text: 'n-object', height: 4, fontSize: 4, verticalAlign: 'top' })
				);

				// n-container
				var ncontainer = new THREE.Mesh(new THREE.BoxBufferGeometry(2, 2, 2), new THREE.MeshBasicMaterial({ color: 0xffbbee, transparent: true, opacity: 0.3 }));
				ncontainer.position.set(0, 0, 5);
				sim.scene.add(ncontainer);
				ncontainer.addEventListener('container-count-changed', function(event) {
					event.target.getBehaviorByType('n-text').data.text = 'n-container\nCount: ' + event.target.getBehaviorByType('n-container').count;
				});
				ncontainer.addEventListener('container-empty', function(event) {
					event.target.getBehaviorByType('n-text').data.text = 'n-container\nCount: ' + event.target.getBehaviorByType('n-container').count + ', State: Empty';
				});
				ncontainer.addEventListener('container-full', function(event) {
					event.target.getBehaviorByType('n-text').data.text = 'n-container\nCount: ' + event.target.getBehaviorByType('n-container').count + ', State: Full';
				});
				ncontainer.addEventListener('triggerenter', function(event) {
					event.target.material.color.set(0xffeeff);
				});
				ncontainer.addEventListener('triggerexit', function(event) {
					event.target.material.color.set(0xffbbee);
				});
				ncontainer.addBehaviors(
					new altspaceutil.behaviors.NativeComponent('n-box-collider', { isTrigger: true, size: { x: 2, y: 2, z: 2 } }),
					new altspaceutil.behaviors.NativeComponent('n-container', { capacity: 2 }),
					new altspaceutil.behaviors.NativeComponent('n-text', { text: 'n-container', height: 4, fontSize: 4, verticalAlign: 'top' })
				);

				// n-sound
				var nsound = new THREE.Mesh(new THREE.PlaneBufferGeometry(1, 1), Object.assign(new THREE.MeshBasicMaterial(), { visible: false }));
				nsound.position.set(5, 0, 5);
				sim.scene.add(nsound);
				nsound.addBehaviors(
					new altspaceutil.behaviors.NativeComponent('n-sound', {
						src: /Mobile/i.test(navigator.userAgent) ? 'test.mp3' : 'test.ogg', // MP3 Supported For Mobile Devices, OGG Supported For Everything Else
						autoplay: false,
						loop: false,
						volume: 0.5,
						minDistance: 1,
						maxDistance: 12,
					}),
					new altspaceutil.behaviors.NativeComponent('n-text', { text: 'n-sound', height: 4, fontSize: 4, verticalAlign: 'top' })
				);
				nsound.addEventListener('n-sound-loaded', function(event) {
					var nsoundcomponent = nsound.getBehaviorByType('n-sound');
					setTimeout(function() {
						nsoundcomponent.callComponent('play');
						nsoundcomponent.callComponent('seek', { time: 0 });
					},1000);
					nsound.getBehaviorByType('n-text').data.text = 'n-sound\nStatus: ' + 'Loaded';
				});
				nsound.addEventListener('sound-paused', function(event) {
					var nsoundcomponent = nsound.getBehaviorByType('n-sound');
					setTimeout(function() {
						nsoundcomponent.callComponent('play');
						nsoundcomponent.callComponent('seek', { time: 0 });
					},3000);
					nsound.getBehaviorByType('n-text').data.text = 'n-sound\nStatus: Paused';
				});
				nsound.addEventListener('sound-played', function(event) {
					var nsoundcomponent = nsound.getBehaviorByType('n-sound');
					setTimeout(function() { nsoundcomponent.callComponent('pause'); }, 3000);
					nsound.getBehaviorByType('n-text').data.text = 'n-sound\nStatus: Playing';
				});

				// n-cockpit-parent
				var ncockpitparent = new THREE.Mesh(new THREE.PlaneBufferGeometry(1, 1), new THREE.MeshBasicMaterial({ color: 0xFF0000, transparent: true, opacity: 0.3, side: THREE.DoubleSide }));
				ncockpitparent.position.set(-2.5, 0, -4);
				sim.scene.add(ncockpitparent);
				ncockpitparent.addBehaviors(
					new altspaceutil.behaviors.NativeComponent('n-text', { text: 'n-cockpit-parent', height: 2, fontSize: 2, verticalAlign: 'top' }),
					new altspaceutil.behaviors.NativeComponent('n-cockpit-parent')
				);

				// n-skeleton-parent
				var nskeletonparent = new THREE.Mesh(new THREE.BoxBufferGeometry(0.2, 0.2, 0.2), new THREE.MeshBasicMaterial({ color: 0xFF0000, transparent: true, opacity: 0.3 }));
				nskeletonparent.position.set(0, 0.3, 0);
				sim.scene.add(nskeletonparent);
				nskeletonparent.addBehaviors(
					new altspaceutil.behaviors.NativeComponent('n-skeleton-parent', { part: 'head', side: 'center' }),
					new altspaceutil.behaviors.NativeComponent('n-text', { text: 'n-skeleton-parent', height: 1, fontSize: 2, verticalAlign: 'top' })
				);

				// n-portal (Space)
				var nportal = new THREE.Group();
				nportal.position.set(5, 0, 10);
				sim.scene.add(nportal);
				nportal.addBehaviors(
					new altspaceutil.behaviors.NativeComponent('n-portal', { targetSpace: 'campfire-lobby' }),
					new altspaceutil.behaviors.NativeComponent('n-text', { text: 'n-portal\nThe Campfire', height: 6, fontSize: 3, verticalAlign: 'top' })
				);

				// n-portal (Position)
				var nportal = new THREE.Group();
				nportal.position.set(0, 0, 10);
				sim.scene.add(nportal);
				nportal.addBehaviors(
					new altspaceutil.behaviors.NativeComponent('n-portal', {}, { targetEntity: nspherecollider }),
					new altspaceutil.behaviors.NativeComponent('n-text', { text: 'n-portal\nCurrent Space', height: 6, fontSize: 3, verticalAlign: 'top' })
				);

				// n-text / n-billboard
				var ntext = new THREE.Mesh(new THREE.PlaneBufferGeometry(1, 1), Object.assign(new THREE.MeshBasicMaterial(), { visible: false }));
				ntext.position.set(-15, 2, 10);
				sim.scene.add(ntext);
				ntext.addBehaviors(
					new altspaceutil.behaviors.NativeComponent('n-text', { text: 'n-text / n-billboard', fontSize: 3, width: 100 }),
					new altspaceutil.behaviors.NativeComponent('n-billboard')
				);

				(function updateText() {
					requestAnimationFrame(updateText);

					// Retrieve Component From Object
					var ntextcomponent = ntext.getBehaviorByType('n-text');

					// Update Component Property
					if(ntextcomponent) ntextcomponent.data.text = 'n-text / n-billboard\n' + new Date().toLocaleString();
				}());
			});
		});
		</script>
	</body>
</html>