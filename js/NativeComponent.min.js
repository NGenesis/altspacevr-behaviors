"use strict";function initCollisionEventHandler(){altspace.inClient&&this.placeholder&&(this.nativeEvents.NativeCollisionEvent=altspaceutil.addNativeEventListener("NativeCollisionEvent",function(t,e,i,a,s,n,o,r,l,c,h,d){var p=altspaceutil.getObject3DById(e),u=altspaceutil.getObject3DById(i);if(p===this.placeholder||u===this.placeholder){var f={type:t,bubbles:!0,target:p===this.placeholder?this.object3d:p,other:u===this.placeholder?this.object3d:u,relativeVelocity:{x:a,y:s,z:n}};o&&(f.point={position:{x:c,y:h,z:d},normal:{x:o,y:r,z:l}}),this.object3d.dispatchEvent(f)}}.bind(this)),this.nativeEvents.NativeTriggerEvent=altspaceutil.addNativeEventListener("NativeTriggerEvent",function(t,e,i){var a=altspaceutil.getObject3DById(e),s=altspaceutil.getObject3DById(i);if(a===this.placeholder||s===this.placeholder){var n={type:t,bubbles:!0,target:a===this.placeholder?this.object3d:a,other:s===this.placeholder?this.object3d:s};this.object3d.dispatchEvent(n)}}.bind(this)))}window.altspaceutil=window.altspaceutil||{},altspaceutil.behaviors=altspaceutil.behaviors||{},altspaceutil.VERSION=altspaceutil.VERSION||"1.1.5",altspaceutil.addNativeEventListener=function(t,e){return altspace._internal&&altspace._internal.couiEngine?altspace._internal.couiEngine.on(t,e):null},altspaceutil.removeNativeEventListener=function(t,e){altspace._internal&&altspace._internal.couiEngine&&altspace._internal.couiEngine.off(t,e)},altspaceutil.removeAllNativeEventListeners=function(t){altspace._internal&&altspace._internal.couiEngine&&altspace._internal.couiEngine.events[t]&&delete altspace._internal.couiEngine.events[t]},altspaceutil.getObject3DById=function(t){return altspace._internal&&altspace._internal.getObject3DById?altspace._internal.getObject3DById(t):null},altspaceutil._currentThreeJSScene=null,altspaceutil.getThreeJSScene=function(){return altspace._internal&&altspace._internal.getThreeJSScene?altspace._internal.getThreeJSScene():altspaceutil._currentThreeJSScene},altspaceutil.setThreeJSScene=function(t){altspace._internal&&altspace._internal.setThreeJSScene?altspace._internal.setThreeJSScene(t):altspaceutil._currentThreeJSScene=t},altspaceutil.expandSerializationBuffer=function(t){altspace.inClient&&altspace._internal&&altspace._internal.ScratchThriftBuffer&&t>0&&altspace._internal.ScratchThriftBuffer.grow(t)},altspaceutil.profileSerializationBuffer=function(t){altspace.inClient&&altspace._internal&&altspace._internal.ScratchThriftBuffer&&(altspace._internal.ScratchThriftBuffer.profile=void 0===t||t)},altspaceutil.isMobileApp=function(t){return/mobile/i.test(navigator.userAgent)},altspaceutil.getFullspaceEnclosure=function(){let t=altspace.inClient?altspace.getEnclosure:()=>{return altspaceutil._BrowserEnclosure||(altspaceutil._BrowserEnclosure=new class extends THREE.EventDispatcher{constructor(){super(),this.innerWidth=1280,this.innerHeight=720,this.innerDepth=1280,this.pixelsPerMeter=1,this.hasFocus=document.hasFocus(),this.fullspace=!0,window.addEventListener("focus",()=>this.hasFocus=document.hasFocus()),window.addEventListener("blur",()=>this.hasFocus=document.hasFocus())}requestFullspace(){return this.fullspace||(this.fullspace=!0,this.dispatchEvent({type:"fullspacechange"})),Promise.resolve()}exitFullspace(){return this.fullspace&&(this.fullspace=!1,this.dispatchEvent({type:"fullspacechange"})),Promise.resolve()}}),Promise.resolve(altspaceutil._BrowserEnclosure)};return new Promise((e,i)=>{t().then(t=>t.requestFullspace().then(()=>{t.addEventListener("fullspacechange",()=>{t.fullspace||t.requestFullspace().catch(()=>i("enclosure.requestFullspace() after fullspacechange event failed"))}),e(t)})).catch(()=>i("Failed to get fullspace enclosure."))})},altspaceutil.getFullspaceAppManifest=function(){if(altspaceutil._fullspaceAppManifest)return Promise.resolve(altspaceutil._fullspaceAppManifest);let t=new URLSearchParams(window.location.search),e=e=>{for(let i of t.entries())if(/altvr\.enclosure\.(.*)/i.test(i[0])){let t=i[0].match(/altvr\.enclosure\.(.*)/i)[1],a=e.enclosure=Object.assign({},e.enclosure);switch(a.position=Object.assign({x:0,y:0,z:0},a.position),a.rotation=Object.assign({x:0,y:0,z:0},a.rotation),a.scale=a.hasOwnProperty("scale")&&"number"==typeof a.scale?{x:a.scale||1,y:a.scale||1,z:a.scale||1}:Object.assign({x:1,y:1,z:1},a.scale),t){case"position":case"rotation":{let e=i[1].split(",");e.length>=1&&(a[t].x=parseFloat(e[0])||0),e.length>=2&&(a[t].y=parseFloat(e[1])||0),e.length>=3&&(a[t].z=parseFloat(e[2])||0);break}case"scale":{let e=i[1].split(",");1===e.length?a[t].x=a[t].y=a[t].z=parseFloat(e[0])||1:(e.length>=1&&(a[t].x=parseFloat(e[0])||1),e.length>=2&&(a[t].y=parseFloat(e[1])||1),e.length>=3&&(a[t].z=parseFloat(e[2])||1));break}}}else if(/altvr\.anchors\.(.*)\.(.*)/i.test(i[0])){let[,t,a]=i[0].match(/altvr\.anchors\.(.*)\.(.*)/i),s=e.anchors.findIndex(e=>{return e.name===t});switch(s<0&&(s=e.anchors.push({name:t})-1),anchormanifest=e.anchors[s]=Object.assign({name:t},e.anchors[s]),anchormanifest.position=Object.assign({x:0,y:0,z:0},anchormanifest.position),anchormanifest.rotation=Object.assign({x:0,y:0,z:0},anchormanifest.rotation),anchormanifest.scale=anchormanifest.hasOwnProperty("scale")&&"number"==typeof anchormanifest.scale?{x:anchormanifest.scale||1,y:anchormanifest.scale||1,z:anchormanifest.scale||1}:Object.assign({x:1,y:1,z:1},anchormanifest.scale),a){case"position":case"rotation":{let t=i[1].split(",");t.length>=1&&(anchormanifest[a].x=parseFloat(t[0])||0),t.length>=2&&(anchormanifest[a].y=parseFloat(t[1])||0),t.length>=3&&(anchormanifest[a].z=parseFloat(t[2])||0);break}case"scale":{let t=i[1].split(",");1===t.length?anchormanifest[a].x=anchormanifest[a].y=anchormanifest[a].z=parseFloat(t[0])||1:(t.length>=1&&(anchormanifest[a].x=parseFloat(t[0])||1),t.length>=2&&(anchormanifest[a].y=parseFloat(t[1])||1),t.length>=3&&(anchormanifest[a].z=parseFloat(t[2])||1));break}}}};return t.has("altvr.manifest")&&t.get("altvr.manifest").length>0?new Promise((i,a)=>{fetch(altspaceutil.getAbsoluteURL(t.get("altvr.manifest"))).then(t=>t.json()).then(t=>{altspaceutil._fullspaceAppManifest=t,e(altspaceutil._fullspaceAppManifest),i(altspaceutil._fullspaceAppManifest)}).catch(()=>a("Failed to download manifest from "+t.get("altvr.manifest")))}):(altspaceutil._fullspaceAppManifest={enclosure:{position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scale:{x:1,y:1,z:1}},anchors:[]},e(altspaceutil._fullspaceAppManifest),Promise.resolve(altspaceutil._fullspaceAppManifest))},altspaceutil.FullspaceApp=class{constructor(t){this.config=Object.assign({serializationBufferSize:5e5},t),this.config.serializationBufferSize&&altspaceutil.expandSerializationBuffer(this.config.serializationBufferSize)}initialize(){let t=()=>{return this._isInitializing||this._isInitialized?new Promise((t,e)=>{let i=setInterval(()=>{this._isInitializing||(clearInterval(i),t())},10)}):(this._isInitializing=!0,Promise.resolve())},e=altspace.inClient?altspace.getSpace():Promise.resolve({sid:"browser",name:"Web Space",templateSid:"browser"});return new Promise((i,a)=>{t().then(()=>{return this._isInitialized?i(this):(this._isInitializing=!0,Promise.all([altspaceutil.getFullspaceEnclosure(),altspaceutil.getFullspaceAppManifest(),e]).then(t=>{let[e,a,s]=t;if(this._enclosure=e,this._manifest=a,this._space=s,this._scene=new THREE.Scene,this._camera=new THREE.PerspectiveCamera,altspace.inClient)this._renderer=altspace.getThreeJSRenderer();else{this._renderer=new THREE.WebGLRenderer({antialias:!0,alpha:!0}),Object.assign(this._camera,{fov:90,near:1,far:2e3}),this._camera.position.z=20;let t=()=>{this._renderer.setClearColor(16777215,0),document.body.style.backgroundColor="#000000",document.body.style.margin="0px",document.body.style.overflow="hidden",document.body.appendChild(this._renderer.domElement),this._renderer.domElement.oncontextmenu=(()=>!1)};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",t):t();let e=()=>{this._camera.aspect=window.innerWidth/window.innerHeight,this._camera.updateProjectionMatrix(),this._renderer.setSize(window.innerWidth,window.innerHeight)};window.addEventListener("resize",e),e(),this._scene.add(this._camera),this._scene.add(new THREE.AmbientLight("white")),altspace.utilities.shims.cursor.init(this._scene,this._camera,{renderer:this._renderer})}this._anchors={},this._anchor=Object.assign(new THREE.Group,{name:"altvr.enclosure"}),this._scene.add(this._anchor);let n=this._manifest?this._manifest.enclosure:null;n&&(this._anchor.position.copy(n.position),this._anchor.rotation.set(THREE.Math.degToRad(n.rotation.x),THREE.Math.degToRad(n.rotation.y),THREE.Math.degToRad(n.rotation.z)),this._anchor.scale.copy(n.scale)),this._anchorsGroup=Object.assign(new THREE.Group,{name:"altvr.anchors"}),this._anchorsGroup.addBehavior(new class t{get type(){return"_ApplyAppAnchorTransform"}constructor(t){this.anchor=t}awake(t){this.object3d=t,this.object3d.position.copy(this.anchor.position),this.object3d.quaternion.copy(this.anchor.quaternion),this.object3d.scale.copy(this.anchor.scale)}update(){this.object3d.position.copy(this.anchor.position),this.object3d.quaternion.copy(this.anchor.quaternion),this.object3d.scale.copy(this.anchor.scale)}}(this._anchor)),this._scene.add(this._anchorsGroup),this._isInitialized=!0;let o=()=>{window.requestAnimationFrame(o),this._scene.updateAllBehaviors(),this._renderer.render(this._scene,this._camera)};o(),this._isInitializing=!1,i(this)}))}).catch(()=>{this._isInitializing=!1,a("Failed to initialize fullspace app.")})})}anchors(t){if(this._anchors[t])return this._anchors[t];let e=this._anchors[t]=Object.assign(new THREE.Group,{name:t});this._anchorsGroup.add(e);let i=this._manifest.anchors.find(e=>{return e.name===t});return i&&(e.position.copy(i.position),e.rotation.set(THREE.Math.degToRad(i.rotation.x),THREE.Math.degToRad(i.rotation.y),THREE.Math.degToRad(i.rotation.z)),e.scale.copy(i.scale)),e}get scene(){return this._scene}get renderer(){return this._renderer}get camera(){return this._camera}get anchor(){return this._anchor}get enclosure(){return this._enclosure}get space(){return this._space}},altspaceutil.getFullspaceApp=function(t){return altspaceutil._fullspaceApp||(altspaceutil._fullspaceApp=new altspaceutil.FullspaceApp(t)),altspaceutil._fullspaceApp.initialize()},altspaceutil.getAbsoluteURL=function(t){return new URL(t,window.location).toString()},altspaceutil.getBasePath=function(t){return t.split("/").slice(0,-1).join("/")+"/"},altspaceutil.loadTexture=function(t,e){if(altspace.inClient){if(t.startsWith("blob:")){let e=new THREE.Texture;return fetch(t).then(t=>t.blob()).then(i=>{let a=new FileReader;a.onerror=(()=>console.warn("Failed to load blob texture at "+t)),a.onload=(()=>Object.assign(e,{image:{nodeName:"CANVAS",toDataURL:()=>a.result},needsUpdate:!0})),a.readAsDataURL(i)}),e}return t.startsWith("data:")?Object.assign(new THREE.Texture({nodeName:"CANVAS",toDataURL:()=>t}),{needsUpdate:!0}):new THREE.Texture({src:altspaceutil.getAbsoluteURL(t)})}e=Object.assign({crossOrigin:"anonymous"},e);var i=new THREE.TextureLoader;return"anonymous"!==e.crossOrigin&&i.setCrossOrigin(e.crossOrigin),void 0!==e.withCredentials&&i.setWithCredentials(e.withCredentials),void 0!==e.path&&i.setPath(e.path),i.load(t)},altspaceutil.setCursorCollider=function(t,e,i){t&&(i?t.traverse(t=>{t.userData.altspace||(t.userData.altspace={}),t.userData.altspace.collider||(t.userData.altspace.collider={}),t.userData.altspace.collider.enabled=e}):(t.userData.altspace||(t.userData.altspace={}),t.userData.altspace.collider||(t.userData.altspace.collider={}),t.userData.altspace.collider.enabled=e))},altspaceutil.isCursorCollider=function(t){return!!t&&(!t.userData.altspace||!t.userData.altspace.collider||void 0===t.userData.altspace.enabled||t.userData.altspace.enabled)},altspaceutil.manageBehavior=function(t,e){t.__isManaged=!0,e.__resetManagedBehavior||e.addEventListener("removed",e.__resetManagedBehavior=function(){e.__resetManagedBehavior&&(e.removeEventListener("removed",e.__resetManagedBehavior),e.__resetManagedBehavior=null),e.traverse(function(t){if(t.__behaviorList)for(var e of t.__behaviorList)if(e.__isInitialized&&e.__isManaged)try{e.dispose&&e.dispose.call(e,t),e.__isInitialized=!1}catch(i){console.group(),(console.error||console.log).call(console,i.stack||i),console.log("[Behavior]"),console.log(e),console.log("[Object3D]"),console.log(t),console.groupEnd()}})})},altspaceutil.unmanageBehavior=function(t,e){t.__isManaged=!1},altspaceutil.cloneWithBehaviors=function(t,e){var i=t.clone(!1);if(t.__behaviorList&&t.__behaviorList.length>0)for(var a of t.__behaviorList)try{if(a.clone){var s=a.clone.call(a,i,t);s&&(i.__behaviorList=i.__behaviorList||[],i.__behaviorList.push(s))}}catch(e){console.group(),(console.error||console.log).call(console,e.stack||e),console.log("[Behavior]"),console.log(a),console.log("[Object3D]"),console.log(t),console.groupEnd()}if(void 0===e||e)for(var n of t.children)i.add(n.cloneWithBehaviors(!0));return i},altspaceutil.loadScript=((t,e)=>{if(e=Object.assign({loadOnce:!0},e),altspaceutil._loadedScripts=altspaceutil._loadedScripts||{},e.scriptTest&&e.scriptTest(t))return Promise.resolve();if(e.loadOnce){if(altspaceutil._loadedScripts[t]&&altspaceutil._loadedScripts[t].loaded)return Promise.resolve();if(altspaceutil._loadedScripts[t]&&altspaceutil._loadedScripts[t].waiting)return altspaceutil._loadedScripts[t].waiting}let i=document.createElement("script");i.src=new URL(t,window.location).toString(),i.async=!1;let a=void 0===altspaceutil._loadedScripts[t],s=new Promise((s,n)=>{i.onload=(()=>{!e.scriptTest||e.scriptTest(t)?s():(console.warn("Script test failed for script at "+i.src),n("Script test failed for script at "+i.src)),a&&(altspaceutil._loadedScripts[t].loaded=!0,altspaceutil._loadedScripts[t].waiting=null)}),i.onerror=(()=>{a&&(altspaceutil._loadedScripts[t].waiting=null,delete altspaceutil._loadedScripts[t]),console.warn("Failed to load script at "+i.src),n("Failed to load script at "+i.src)})});if(a&&(altspaceutil._loadedScripts[t]={waiting:s}),altspaceutil._lastLoadScript)altspaceutil._lastLoadScript.parentNode.insertBefore(i,altspaceutil._lastLoadScript.nextSibling);else{let t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(i,t)}return altspaceutil._lastLoadScript=i,s}),altspaceutil.loadScripts=(t=>{return!t||t.length<=0?Promise.resolve():Promise.all(t.map(t=>"string"==typeof t||t instanceof String?altspaceutil.loadScript(t):altspaceutil.loadScript(t.url,t)))}),altspaceutil.overrideTextureLoader=(t=>{altspace.inClient&&(altspaceutil._isTextureLoaderOverridden=t)}),altspace.inClient&&(altspaceutil._originalTextureLoaderFunc||(altspaceutil._originalTextureLoaderFunc=THREE.TextureLoader.prototype.load),altspaceutil._isTextureLoaderOverridden=!0,THREE.TextureLoader.prototype.load=function(t,e){if(!altspaceutil._isTextureLoaderOverridden)return altspaceutil._originalTextureLoaderFunc.apply(this,arguments);let i=altspaceutil.loadTexture(t);return e&&e(i),i}),altspaceutil._assetLoaders||(altspaceutil._assetLoaders=new class{constructor(){this.handlers=[],this.add(/\.obj$/i,(t,e)=>{return new Promise((i,a)=>{altspaceutil.loadScript("https://cdn.jsdelivr.net/combine/npm/three@0."+THREE.REVISION+".0/examples/js/loaders/MTLLoader.min.js,npm/three@0."+THREE.REVISION+".0/examples/js/loaders/OBJLoader.min.js",{scriptTest:()=>THREE.MTLLoader&&THREE.OBJLoader}).then(()=>{let s=new THREE.FileLoader;s.load(t,s=>{let n=/^[\s]*mtllib[\s]+(.*\.mtl)[\s]*$/m.exec(s);if(n){n=new URL(n[1],t).toString();let o=new THREE.MTLLoader;o.setCrossOrigin(e.crossOrigin),o.setTexturePath(altspaceutil.getBasePath(n)),o.load(n,t=>{t.preload(),i((new THREE.OBJLoader).setMaterials(t).parse(s))},null,()=>a("Could not retrieve materials from "+n))}else i((new THREE.OBJLoader).parse(s))},null,()=>a("Could not retrieve asset from "+t))}).catch(()=>a("Could not load scripts for MTLLoader/OBJLoader"))})}),this.add(/\.gltf|\.glb$/i,(t,e)=>{if(altspace.inClient&&(void 0===e.native||e.native)){let i=new THREE.Object3D;return i.addBehavior(new altspaceutil.behaviors.NativeComponent("n-gltf",{url:t,sceneIndex:e.sceneIndex||0},{useCollider:e.cursorCollider})),Promise.resolve(i)}return new Promise((i,a)=>{altspaceutil.loadScript("https://cdn.jsdelivr.net/npm/three@0."+THREE.REVISION+".0/examples/js/loaders/GLTFLoader.min.js",{scriptTest:()=>THREE.GLTFLoader}).then(()=>{let s=new THREE.GLTFLoader;s.setCrossOrigin(e.crossOrigin),s.load(t,t=>i(e.sceneIndex>0&&t.scenes&&e.sceneIndex<t.scenes.length?t.scenes[e.sceneIndex]:t.scene),null,()=>a("Could not retrieve asset from "+t))}).catch(()=>a("Could not load scripts for GLTFLoader"))})}),this.add(/\.dae$/i,(t,e)=>{return new Promise((i,a)=>{altspaceutil.loadScript("https://cdn.jsdelivr.net/npm/three@0."+THREE.REVISION+".0/examples/js/loaders/ColladaLoader.min.js",{scriptTest:()=>THREE.ColladaLoader}).then(()=>{if(altspace.inClient){let s=new THREE.FileLoader;s.load(t,a=>{let s=THREE.TextureLoader.prototype.load;THREE.TextureLoader.prototype.load=((e,...i)=>s.call(this,new URL(e,t).toString(),...i));let n=new THREE.ColladaLoader;n.setCrossOrigin(e.crossOrigin);let o=n.parse(a,altspaceutil.getBasePath(t));THREE.TextureLoader.prototype.load=s,i(o.scene)},null,()=>a("Could not retrieve asset from "+t))}else{let s=new THREE.ColladaLoader;s.setCrossOrigin(e.crossOrigin),s.load(t,t=>i(t.scene),null,()=>a("Could not retrieve asset from "+t))}}).catch(()=>a("Could not load scripts for ColladaLoader"))})}),this.add(/\.fbx$/i,(t,e)=>{return new Promise((i,a)=>{altspaceutil.loadScript("https://cdn.jsdelivr.net/combine/npm/three@0."+THREE.REVISION+".0/examples/js/libs/inflate.min.js,npm/three@0."+THREE.REVISION+".0/examples/js/loaders/FBXLoader.min.js",{scriptTest:()=>THREE.FBXLoader}).then(()=>{let s=new THREE.FBXLoader;s.setCrossOrigin(e.crossOrigin),s.load(t,t=>i(t),null,()=>a("Could not retrieve asset from "+t))}).catch(()=>a("Could not load scripts for FBXLoader"))})}),this.add(/\.stl$/i,(t,e)=>{return new Promise((i,a)=>{altspaceutil.loadScript("https://cdn.jsdelivr.net/npm/three@0."+THREE.REVISION+".0/examples/js/loaders/STLLoader.min.js",{scriptTest:()=>THREE.STLLoader}).then(()=>{let s=new THREE.STLLoader;s.setCrossOrigin&&s.setCrossOrigin(e.crossOrigin),s.load(t,t=>i(new THREE.Mesh(t,t.hasColors?new THREE.MeshBasicMaterial({opacity:t.alpha,transparent:t.alpha<1,vertexColors:THREE.VertexColors}):void 0)),null,()=>a("Could not retrieve asset from "+t))}).catch(()=>a("Could not load scripts for STLLoader"))})}),this.add(/\.assimp$/i,(t,e)=>{return new Promise((i,a)=>{altspaceutil.loadScript("https://cdn.jsdelivr.net/npm/three@0."+THREE.REVISION+".0/examples/js/loaders/AssimpLoader.min.js",{scriptTest:()=>THREE.AssimpLoader}).then(()=>{if(altspace.inClient){let s=new THREE.FileLoader;s.setResponseType("arraybuffer"),s.load(t,a=>{let s=THREE.TextureLoader.prototype.load;THREE.TextureLoader.prototype.load=((e,...i)=>s.call(this,new URL(e,t).toString(),...i));let n=new THREE.AssimpLoader;n.setCrossOrigin(e.crossOrigin);let o=n.parse(a,altspaceutil.getBasePath(t));THREE.TextureLoader.prototype.load=s,i(o.object)},null,()=>a("Could not retrieve asset from "+t))}else{let s=new THREE.AssimpLoader;s.setCrossOrigin(e.crossOrigin),s.load(t,t=>i(t.object),null,()=>a("Could not retrieve asset from "+t))}}).catch(()=>a("Could not load scripts for AssimpLoader"))})}),this.add(/\.bom$/i,(t,e)=>{return new Promise((i,a)=>{altspaceutil.loadScript("https://cdn.jsdelivr.net/gh/NGenesis/bom-three.js@v0.6.3/examples/js/loaders/BOMLoader.min.js",{scriptTest:()=>THREE.BOMLoader}).then(()=>{let s=new THREE.BOMLoader;s.setCrossOrigin(e.crossOrigin),s.load(t,t=>i(t),null,()=>a("Could not retrieve asset from "+t))}).catch(()=>a("Could not load scripts for BOMLoader"))})})}add(t,e){this.handlers.push({regex:t,handler:e})}remove(t,e){this.handlers=this.handlers.filter(i=>i.regex.toString()!==t.toString()&&(!e||i.handler!==e))}get(t){let e=new URL(t).pathname;for(let i of this.handlers)if(i.regex.test(e))return i.handler;return null}}),altspaceutil.addAssetLoader=((t,e)=>{altspaceutil._assetLoaders.add(t,e)}),altspaceutil.removeAssetLoader=((t,e)=>{altspaceutil._assetLoaders.remove(t,e)}),altspaceutil.loadAsset=((t,e)=>{t=altspaceutil.getAbsoluteURL(t),e=Object.assign({applyTransform:!0,cursorCollider:!1,crossOrigin:"anonymous"},e);let i=t=>{return altspaceutil.setCursorCollider(t,!!e.cursorCollider,!0),e.applyTransform&&(e.position&&(e.position=Object.assign({x:0,y:0,z:0},e.position),t.position.copy(e.position)),e.quaternion?(e.quaternion=Object.assign({x:0,y:0,z:0,w:1},e.quaternion),t.quaternion.copy(e.quaternion)):e.rotation&&(e.rotation=Object.assign({x:0,y:0,z:0},e.rotation),t.rotation.set(e.rotation.x,e.rotation.y,e.rotation.z)),e.scale&&(e.scale=e.hasOwnProperty("scale")&&"number"==typeof e.scale?{x:e.scale||1,y:e.scale||1,z:e.scale||1}:Object.assign({x:1,y:1,z:1},e.scale),t.scale.copy(e.scale))),new Promise((i,a)=>{let s=e.onLoaded?e.onLoaded(t):null;s instanceof Promise?s.then(()=>i(t)).catch(t=>a("Error occurred while processing onLoaded asset handler",t)):i(t)})},a=altspaceutil._assetLoaders.get(t,e);return a?a(t,e).then(i):Promise.reject("Could not get asset handler for "+t)}),altspaceutil.loadAssets=(t=>{return t?new Promise((e,i)=>{let a=Array.isArray(t)?t:Object.values(t);Promise.all(a.map(t=>"string"==typeof t||t instanceof String?altspaceutil.loadAsset(t):altspaceutil.loadAsset(t.url,t))).then(i=>{if(Array.isArray(t))e(i);else{let a={};Object.keys(t).forEach((t,e)=>{a[t]=i[e]}),e(a)}}).catch(t=>i("Could not load assets",t))}):Promise.resolve(t)}),window.altspaceutil=window.altspaceutil||{},altspaceutil.shims=altspaceutil.shims||{},altspaceutil.shims.sdk=altspaceutil.shims.sdk||{},void 0===altspaceutil.shims.sdk.inClient&&(altspaceutil.shims.sdk.inClient=!!altspace.inClient),altspaceutil.shims._currentThreeJSScene=null,altspaceutil.shims.sdk.getThreeJSScene=function(){return altspace.inClient&&altspace._internal&&altspace._internal.getThreeJSScene&&(altspaceutil.shims.sdk._currentThreeJSScene=altspace._internal.getThreeJSScene()),altspaceutil.shims.sdk._currentThreeJSScene},altspaceutil.shims.sdk.setThreeJSScene=function(t){altspace.inClient&&altspace._internal&&altspace._internal.setThreeJSScene&&altspace._internal.setThreeJSScene(t),altspaceutil.shims._currentThreeJSScene=t},altspaceutil.shims.sdk.getEnclosure=function(){return altspaceutil.shims.sdk._EnclosureBrowserShim||(altspaceutil.shims.sdk._EnclosureBrowserShim=new class t extends THREE.EventDispatcher{constructor(){super(),this.innerWidth=1280,this.innerHeight=720,this.innerDepth=1280,this.pixelsPerMeter=1,this.hasFocus=document.hasFocus(),this.fullspace=!1,window.addEventListener("focus",()=>this.hasFocus=document.hasFocus()),window.addEventListener("blur",()=>this.hasFocus=document.hasFocus())}requestFullspace(){return this.fullspace||(this.fullspace=!0,this.dispatchEvent({type:"fullspacechange"})),Promise.resolve()}exitFullspace(){return this.fullspace&&(this.fullspace=!1,this.dispatchEvent({type:"fullspacechange"})),Promise.resolve()}}),Promise.resolve(altspaceutil.shims.sdk._EnclosureBrowserShim)},altspaceutil.shims.sdk.getDocument=function(){return new Promise((t,e)=>{altspace.getEnclosure().then(e=>{return altspaceutil.shims.sdk._DocumentBrowserShim||(altspaceutil.shims.sdk._DocumentBrowserShim=new class t extends THREE.Mesh{constructor(){super(new THREE.PlaneBufferGeometry(-e.innerWidth/1e3,e.innerHeight/1e3,1,1),Object.assign(new THREE.MeshBasicMaterial({side:THREE.DoubleSide,map:new THREE.Texture}),{uuid:"altspace-document",visible:!1})),this.type="Document",this.originalGeometry=this.geometry,this.originalMaterial=this.material,this.inputEnabled=!1,this.audioSpatializationEnabled=!0,this.reset()}get inputEnabled(){return this._inputEnabled}set inputEnabled(t){this._inputEnabled=t}get audioSpatializationEnabled(){return this._audioSpatializationEnabled}set audioSpatializationEnabled(t){this._audioSpatializationEnabled=t}reset(){this.geometry=this.originalGeometry,this.geometry.verticesNeedUpdate=!0,this.geometry.uvsNeedUpdate=!0,this.material=this.originalMaterial,this.material.map.repeat.set(1,1),this.material.map.offset.set(0,0),this.material.side=THREE.DoubleSide;let t=altspaceutil.shims.sdk.getThreeJSScene()||this.parent;t&&(t.add(this),this.matrix.identity(),this.matrix.getInverse(t.matrix),this.applyMatrix(this.matrix))}}),t(altspaceutil.shims.sdk._DocumentBrowserShim)}).catch(t=>e(t))})},altspaceutil.shims.sdk.getSpace=function(){return altspaceutil.shims.sdk._SpaceBrowserShim||(altspaceutil.shims.sdk._SpaceBrowserShim=new class t{constructor(){this.sid="browser",this.name="Web Space",this.templateSid="browser"}}),Promise.resolve(altspaceutil.shims.sdk._SpaceBrowserShim)},altspaceutil.shims.sdk.getUser=function(){return altspaceutil.shims.sdk._UserBrowserShim||(altspaceutil.shims.sdk._UserBrowserShim=new class t{constructor(){this.userId="BrowserGuest",this.displayName="Guest",this.isModerator=!0,this.avatarInfo={sid:"s-series-m01",primaryColor:"rgb(0,0,0)",highlightColor:"rgb(255,255,255)"}}}),Promise.resolve(altspaceutil.shims.sdk._UserBrowserShim)},altspaceutil.shims.sdk.getThreeJSDebugInfo=function(){return Promise.resolve([])},altspaceutil.shims.sdk.getThreeJSTrackingSkeleton=function(){if(!altspaceutil.shims.sdk._ThreeJSTrackingSkeletonBrowserShim){class t extends THREE.Object3D{constructor(t,e,i,a){super(),this.type="TrackingJoint",this.confidence=a,this.name=this.location=t,this.position.copy(e),this.quaternion.copy(i)}getJoint(t,e,i){e=e||"Center",i=void 0===i?0:i,this.trackingJoints[e+t+i]}}altspaceutil.shims.sdk._ThreeJSTrackingSkeletonBrowserShim=new class e extends THREE.Object3D{constructor(){super(),this.type="TrackingSkeleton",Object.values(this.trackingJoints={LeftEye0:new t("LeftEye0",{x:-1.97182,y:1.80098,z:5.81021},{x:.04939496774553409,y:-.7336266303864485,z:.05363520622544854,w:.6756296093292512},3),RightEye0:new t("RightEye0",{x:-1.96686,y:1.80098,z:5.74999},{x:.04939496774553409,y:-.7336266303864485,z:.05363520622544854,w:.6756296093292512},3),CenterHead0:new t("CenterHead0",{x:-1.89206,y:1.78727,z:5.78686},{x:.04939496774553409,y:-.7336266303864485,z:.05363520622544854,w:.6756296093292512},3),CenterNeck0:new t("CenterNeck0",{x:-1.81299,y:1.69395,z:5.79299},{x:-1.8530686175238797e-17,y:-.8420416245242373,z:-1.8530686175238797e-17,w:.539412553217464},3),CenterSpine0:new t("CenterSpine0",{x:-1.81298,y:1.27273,z:5.79299},{x:10001753394771951e-21,y:-.8420524879699061,z:10001753394771948e-21,w:.539395594442169},0),CenterSpine1:new t("CenterSpine1",{x:-1.81299,y:1.3994,z:5.79299},{x:10001753394771951e-21,y:-.8420524879699061,z:10001753394771948e-21,w:.539395594442169},0),CenterSpine2:new t("CenterSpine2",{x:-1.81299,y:1.52607,z:5.79299},{x:10001753394771951e-21,y:-.8420524879699061,z:10001753394771948e-21,w:.539395594442169},0),CenterHips0:new t("CenterHips0",{x:-1.81298,y:1.20273,z:5.79299},{x:-1.8533002074052303e-17,y:-.8420563923075377,z:-1.8533002074052303e-17,w:.5393894995029234},0),CenterEye0:new t("CenterEye0",{x:-1.96934,y:1.80098,z:5.7801},{x:.04939496774553409,y:-.7336266303864485,z:.05363520622544854,w:.6756296093292512},3)}).forEach(t=>this.add(t))}getJoint(t,e,i){e=e||"Center",i=void 0===i?0:i,this.trackingJoints[e+t+i]}}}return Promise.resolve(altspaceutil.shims.sdk._ThreeJSTrackingSkeletonBrowserShim)},altspaceutil.shims.sdk.getGamepads=function(){return navigator.getGamepads()},altspaceutil.shims.sdk.getThreeJSRenderer=function(t){return altspaceutil.shims.sdk._ThreeJSRendererBrowserShim||(t=Object.assign({antialias:!0,version:"0.2.0"},t),altspaceutil.shims.sdk._ThreeJSRendererBrowserShim=new class t extends THREE.WebGLRenderer{constructor(t){console.log("THREE.AltRenderer",THREE.REVISION),console.log("AltRenderer version "+t.version),super(t)}render(t,e,i,a){altspaceutil.shims.sdk.setThreeJSScene(t),super.render(t,e,i,a)}}(t)),altspaceutil.shims.sdk._ThreeJSRendererBrowserShim},altspaceutil.shims.sdk.open=function(t,e,i){e=e||"_blank",i=Object.assign({hidden:!1},i);let a=new class a{constructor(){this.window=null,this.url=t,this.closed=!1,i.hidden&&"_blank"===e||(this.window=window.open(this.url,"_blank"))}show(){return this.closed||this.window||(this.window=window.open(this.url,"_blank")),Promise.resolve()}close(){return!this.closed&&this.window&&(this.closed=!0,this.window.close(),this.window=null),Promise.resolve()}};return Promise.resolve(a)},altspaceutil.shims.sdk.addNativeComponent=function(t,e){},altspaceutil.shims.sdk.removeNativeComponent=function(t,e){},altspaceutil.shims.sdk.updateNativeComponent=function(t,e,i){},altspaceutil.shims.sdk.callNativeComponentAction=function(t,e,i,a){},altspaceutil.shims.sdk.callNativeComponentFunc=function(t,e,i,a){return"n-gltf"===e&&"GetBoundingBox"===i?Promise.resolve({center:{x:0,y:0,z:0},extents:{x:0,y:0,z:0}}):Promise.resolve({})},altspaceutil.initializeAltspaceShims=function(t){return altspace.inClient&&!t||(altspace.inClient=altspaceutil.shims.sdk.inClient,altspace.getDocument=altspaceutil.shims.sdk.getDocument,altspace.getEnclosure=altspaceutil.shims.sdk.getEnclosure,altspace.getSpace=altspaceutil.shims.sdk.getSpace,altspace.getUser=altspaceutil.shims.sdk.getUser,altspace.getThreeJSDebugInfo=altspaceutil.shims.sdk.getThreeJSDebugInfo,altspace.getThreeJSTrackingSkeleton=altspaceutil.shims.sdk.getThreeJSTrackingSkeleton,altspace.getGamepads=altspaceutil.shims.sdk.getGamepads,altspace.getThreeJSRenderer=altspaceutil.shims.sdk.getThreeJSRenderer,altspace.open=altspaceutil.shims.sdk.open,altspace.addNativeComponent=altspaceutil.shims.sdk.addNativeComponent,altspace.removeNativeComponent=altspaceutil.shims.sdk.removeNativeComponent,altspace.updateNativeComponent=altspaceutil.shims.sdk.updateNativeComponent,altspace.callNativeComponentAction=altspaceutil.shims.sdk.callNativeComponentAction,altspace.callNativeComponentFunc=altspaceutil.shims.sdk.callNativeComponentFunc),Promise.resolve()},altspaceutil.initializeAltspaceShims(),altspaceutil.behaviors.NativeComponentPlaceholderMesh=altspaceutil.behaviors.NativeComponentPlaceholderMesh||new THREE.Mesh(new THREE.BoxBufferGeometry(.001,.001,.001),Object.assign(new THREE.MeshBasicMaterial,{visible:!1})),altspaceutil.behaviors.NativeComponentDefaults={"n-object":{data:{res:"architecture/wall-4w-4h"}},"n-spawner":{data:{res:"interactables/basketball"}},"n-text":{data:{text:"",fontSize:10,width:10,height:1,horizontalAlign:"middle",verticalAlign:"middle"},initComponent:function(){altspace.inClient||(this.config.meshComponent=!1,this.shimbehavior=new altspaceutil.behaviors.Text({text:this.data.text,fontSize:this.data.fontSize,width:this.data.width,height:this.data.height,horizontalAlign:this.data.horizontalAlign,verticalAlign:this.data.verticalAlign,native:!1}),this.object3d.addBehavior(this.shimbehavior))},shimUpdate:function(){!altspace.inClient&&this.shimbehavior&&(this.shimbehavior.config.text=this.data.text,this.shimbehavior.config.fontSize=this.data.fontSize,this.shimbehavior.config.width=this.data.width,this.shimbehavior.config.height=this.data.height,this.shimbehavior.config.horizontalAlign=this.data.horizontalAlign,this.shimbehavior.config.verticalAlign=this.data.verticalAlign)}},"n-sphere-collider":{data:{isTrigger:!1,center:{x:0,y:0,z:0},radius:0,type:"environment"},config:{meshComponent:!0},initComponent:initCollisionEventHandler},"n-box-collider":{data:{isTrigger:!1,center:{x:0,y:0,z:0},size:{x:0,y:0,z:0},type:"environment"},config:{meshComponent:!0},initComponent:initCollisionEventHandler},"n-capsule-collider":{data:{isTrigger:!1,center:{x:0,y:0,z:0},radius:0,height:0,direction:"y",type:"environment"},config:{meshComponent:!0},initComponent:initCollisionEventHandler},"n-mesh-collider":{data:{isTrigger:!1,convex:!0,type:"environment"},config:{recursiveMesh:!0,inheritParentData:!0,meshComponent:!0},initComponent:initCollisionEventHandler},"n-container":{data:{capacity:4},config:{meshComponent:!0},attributes:{count:0},initComponent:function(){if(altspace.inClient&&(this.nativeEvents.NativeContainerCountChanged=altspaceutil.addNativeEventListener("NativeContainerCountChanged",function(t,e,i){
var a=altspaceutil.getObject3DById(t);a&&a===this.component&&(this.attributes.count=e,a.dispatchEvent({type:"container-count-changed",detail:{count:e,oldCount:i},bubbles:!0,target:a}))}.bind(this)),this.nativeEvents.NativeContainerStateChanged=altspaceutil.addNativeEventListener("NativeContainerStateChanged",function(t,e,i){var a=altspaceutil.getObject3DById(t);if(a&&a===this.component){var s=this.state;this.state=i?e:void 0,a.dispatchEvent({type:i?"stateadded":"stateremoved",detail:{state:e},bubbles:!0,target:a}),this.state!==s&&this.state&&a.dispatchEvent({type:e,bubbles:!0,target:a})}}.bind(this))),this.placeholder){var t=function(t){this.object3d.dispatchEvent(t)}.bind(this);this.placeholder.addEventListener("container-count-changed",t),this.placeholder.addEventListener("container-empty",t),this.placeholder.addEventListener("container-full",t),this.placeholder.addEventListener("triggerenter",t),this.placeholder.addEventListener("triggerexit",t)}}},"n-sound":{data:{on:"",res:"",src:"",loop:!1,volume:1,autoplay:!1,oneshot:!1,spatialBlend:1,pitch:1,minDistance:1,maxDistance:12,rolloff:"logarithmic"},attributes:{loaded:!1},initComponent:function(){this.data.src=altspaceutil.getAbsoluteURL(this.data.src),altspace.inClient?(altspaceutil.overrideNativeSoundLoadedEvent||(altspaceutil.overrideNativeSoundLoadedEvent=!0,altspaceutil.removeAllNativeEventListeners("NativeSoundLoadedEvent"),altspaceutil.addNativeEventListener("NativeSoundLoadedEvent",function(t){altspace._internal.forwardEventToChildIFrames("NativeSoundLoadedEvent",arguments);var e=altspace._internal.getObject3DById(t);e&&e.el&&e.el.emit("n-sound-loaded",null,!0)})),this.nativeEvents.NativeSoundLoadedEvent=altspaceutil.addNativeEventListener("NativeSoundLoadedEvent",function(t){var e=altspaceutil.getObject3DById(t);e&&e===this.component&&(this.attributes.loaded=!0,e.dispatchEvent({type:"n-sound-loaded",bubbles:!0,target:e}))}.bind(this)),this.placeholder&&(this.placeholder.addEventListener("n-sound-loaded",t=>this.object3d.dispatchEvent(t)),this.placeholder.addEventListener("sound-paused",t=>this.object3d.dispatchEvent(t)),this.placeholder.addEventListener("sound-played",t=>this.object3d.dispatchEvent(t)),this.placeholder.addEventListener("sound-stopped",t=>this.object3d.dispatchEvent(t)))):(this.shimbehavior=new altspaceutil.behaviors.Sound({on:this.data.on,res:this.data.res,src:this.data.src,loop:this.data.loop,volume:this.data.volume,autoplay:this.data.autoplay,oneshot:this.data.oneshot,spatialBlend:this.data.spatialBlend,pitch:this.data.pitch,minDistance:this.data.minDistance,maxDistance:this.data.maxDistance,rolloff:this.data.rolloff,native:!1}),this.object3d.addEventListener("sound-loaded",()=>{this.attributes.loaded=!0,this.object3d.dispatchEvent({type:"n-sound-loaded",bubbles:!0,target:this.object3d})}),this.object3d.addBehavior(this.shimbehavior))},callComponentAction:function(t,e){if(altspace.inClient){if("play"===t)this.component.dispatchEvent({type:"sound-played",bubbles:!0,target:this.component});else if("pause"===t)this.component.dispatchEvent({type:"sound-paused",bubbles:!0,target:this.component});else if("stop"===t)return this.component.dispatchEvent({type:"sound-stopped",bubbles:!0,target:this.component}),altspace.callNativeComponentAction(this.component,this.type,"pause"),void altspace.callNativeComponentAction(this.component,this.type,"seek",{time:0});altspace.callNativeComponentAction(this.component,this.type,t,e)}else this.shimbehavior&&("play"===t?this.shimbehavior.play():"pause"===t?this.shimbehavior.pause():"seek"===t?this.shimbehavior.seek(e.time||0):"stop"===t&&this.shimbehavior.stop())},update:function(){this.data.src=altspaceutil.getAbsoluteURL(this.data.src),this.attributes.loaded=!1,this.initialized&&altspace.updateNativeComponent(this.component,this.type,this.data),this.playHandlerType&&(this.component.removeEventListener(this.playHandlerType,this.playHandler),this.playHandlerType=null),this.data.on&&""!==this.data.on&&(void 0===this.playHandler&&(this.playHandler=this.callComponentAction.bind(this,"play")),this.playHandlerType=this.data.on,this.component.addEventListener(this.playHandlerType,this.playHandler))},shimUpdate:function(){!altspace.inClient&&this.shimbehavior&&(this.data.src=altspaceutil.getAbsoluteURL(this.data.src),this.shimbehavior.config.volume=this.data.volume,this.shimbehavior.config.on=this.data.on,this.shimbehavior.config.src===this.data.src&&this.shimbehavior.config.res===this.data.res&&this.shimbehavior.config.loop===this.data.loop&&this.shimbehavior.config.autoplay===this.data.autoplay&&this.shimbehavior.config.oneshot===this.data.oneshot&&this.shimbehavior.config.spatialBlend===this.data.spatialBlend&&this.shimbehavior.config.pitch===this.data.pitch&&this.shimbehavior.config.minDistance===this.data.minDistance&&this.shimbehavior.config.maxDistance===this.data.maxDistance&&this.shimbehavior.config.rolloff===this.data.rolloff||(this.attributes.loaded=!1,this.shimbehavior.config.src=this.data.src,this.shimbehavior.config.res=this.data.res,this.shimbehavior.config.loop=this.data.loop,this.shimbehavior.config.autoplay=this.data.autoplay,this.shimbehavior.config.oneshot=this.data.oneshot,this.shimbehavior.config.spatialBlend=this.data.spatialBlend,this.shimbehavior.config.pitch=this.data.pitch,this.shimbehavior.config.minDistance=this.data.minDistance,this.shimbehavior.config.maxDistance=this.data.maxDistance,this.shimbehavior.config.rolloff=this.data.rolloff))}},"n-skeleton-parent":{data:{part:"head",side:"center",index:0,userId:null},config:{recursiveMesh:!0,inheritParentData:!0,meshComponent:!0}},"n-cockpit-parent":{config:{sendUpdates:!1,recursiveMesh:!0,inheritParentData:!0,meshComponent:!0}},"n-billboard":{config:{sendUpdates:!1,meshComponent:!0},initComponent:function(){altspace.inClient||(this.config.meshComponent=!1,this.shimbehavior=new altspaceutil.behaviors.Billboard({y:!1,native:!1}),this.object3d.addBehavior(this.shimbehavior))}},"n-animator":{config:{sendUpdates:!1,meshComponent:!0}},"n-layout-browser":{data:{url:"about:blank",isEnclosure:!1},initComponent:function(){this.data.url=altspaceutil.getAbsoluteURL(this.data.url),this.scene.userData.altspace=this.scene.userData.altspace||{},this.scene.userData.altspace.initialized=!0},update:function(){this.data.url=altspaceutil.getAbsoluteURL(this.data.url),this.initialized&&altspace.updateNativeComponent(this.component,this.type,this.data)}},"n-portal":{data:{targetSpace:null,targetEvent:null,targetPosition:{x:0,y:0,z:0},targetQuaternion:{x:0,y:0,z:0,w:1}},update:function(){if(this.config.targetEntity){this.scene.updateMatrixWorld(!0),this.data.targetPosition=this.config.targetEntity.getWorldPosition(new THREE.Vector3);var t=this.config.targetEntity.getWorldQuaternion(new THREE.Quaternion);this.data.targetQuaternion={x:t.x,y:t.y,z:t.z,w:t.w}}this.initialized&&altspace.updateNativeComponent(this.component,this.type,this.data)}},"n-gltf":{data:{url:"",sceneIndex:0},attributes:{loaded:!1},initComponent:function(){if(this.data.url=altspaceutil.getAbsoluteURL(this.data.url),altspace.inClient){if(altspaceutil.overrideNativeGLTFLoadedEvent||(altspaceutil.overrideNativeGLTFLoadedEvent=!0,altspaceutil.removeAllNativeEventListeners("NativeGLTFLoadedEvent"),altspaceutil.addNativeEventListener("NativeGLTFLoadedEvent",function(t){altspace._internal.forwardEventToChildIFrames("NativeGLTFLoadedEvent",arguments);var e=altspace._internal.getObject3DById(t);e&&e.el&&e.el.emit("n-gltf-loaded",null,!0)})),this.nativeEvents.NativeGLTFLoadedEvent=altspaceutil.addNativeEventListener("NativeGLTFLoadedEvent",function(t){var e=altspaceutil.getObject3DById(t);e&&e===this.component&&(this.attributes.loaded=!0,e.dispatchEvent({type:"n-gltf-loaded",bubbles:!0,target:e}))}.bind(this)),this.placeholder){var t=function(t){this.object3d.dispatchEvent(t)}.bind(this);this.placeholder.addEventListener("n-gltf-loaded",t)}}else this.shimbehavior=new altspaceutil.behaviors.GLTF({url:this.data.url,sceneIndex:this.data.sceneIndex,native:!1}),this.object3d.addEventListener("gltf-loaded",()=>{this.attributes.loaded=!0,this.object3d.dispatchEvent({type:"n-gltf-loaded",bubbles:!0,target:this.object3d})}),this.object3d.addBehavior(this.shimbehavior)},update:function(){this.data.url=altspaceutil.getAbsoluteURL(this.data.url),this.attributes.loaded=!1,this.initialized&&altspace.updateNativeComponent(this.component,this.type,this.data)},callComponentFunc:function(t,e){return altspace.inClient?altspace.callNativeComponentFunc(this.component,this.type,t,e).then(function(e){return"GetBoundingBox"===t?new THREE.Box3((new THREE.Vector3).subVectors(e.center,e.extents),(new THREE.Vector3).addVectors(e.center,e.extents)):e}):this.shimbehavior&&"GetBoundingBox"===t?this.shimbehavior.getBoundingBox():Promise.resolve()},shimUpdate:function(){!altspace.inClient&&this.shimbehavior&&(this.data.url=altspaceutil.getAbsoluteURL(this.data.url),this.shimbehavior.config.url===this.data.url&&this.shimbehavior.config.sceneIndex===this.data.sceneIndex||(this.attributes.loaded=!1,this.shimbehavior.config.url=this.data.url,this.shimbehavior.config.sceneIndex=this.data.sceneIndex))}},"n-rigidbody":{data:{mass:1,drag:0,angularDrag:.05,useGravity:!0,isKinematic:!1,positionConstraints:[!1,!1,!1],rotationConstraints:[!1,!1,!1]},config:{meshComponent:!0},initComponent:function(){if(altspace.inClient&&this.placeholder){var t=function(t){this.object3d.dispatchEvent(t)}.bind(this);this.placeholder.addEventListener("native-transform-update",t)}}}},altspaceutil.behaviors.NativeComponent=function(t,e,i){this.type=t||"NativeComponent",this.nativeEvents={},this.defaults=altspaceutil.behaviors.NativeComponentDefaults[this.type],this.config=Object.assign({sendUpdates:!0,recursiveMesh:!1,recursive:!1,useCollider:!1,updateOnStaleData:!0,sharedComponent:!0,inheritParentData:!1,meshComponent:!1},this.defaults&&this.defaults.config?JSON.parse(JSON.stringify(this.defaults.config)):{},i),this.data=Object.assign(this.defaults&&this.defaults.data?JSON.parse(JSON.stringify(this.defaults.data)):{},e),this.attributes=this.defaults&&this.defaults.attributes?JSON.parse(JSON.stringify(this.defaults.attributes)):{},this.awake=function(t,e){if(this.scene=e,this.component=this.object3d=t,this.initialized=!1,altspaceutil.manageBehavior(this,this.object3d),!(this.component instanceof THREE.Mesh)){if(this.config.sharedComponent&&this.object3d.userData._sharedNativeComponent)for(var i of this.object3d.userData._sharedNativeComponent.behaviors)if(i!==this&&i.type===this.type){this.config.sharedComponent=!1;break}this.config.sharedComponent&&(this.sharedData=this.object3d.userData._sharedNativeComponent=this.object3d.userData._sharedNativeComponent||{},this.sharedData.placeholder=this.sharedData.placeholder||altspaceutil.behaviors.NativeComponentPlaceholderMesh.clone(),this.sharedData.behaviors=this.sharedData.behaviors||[],this.sharedData.behaviors.push(this),this.sharedData.placeholder.parent||this.object3d.add(this.sharedData.placeholder)),this.component=this.placeholder=this.sharedData&&this.sharedData.placeholder?this.sharedData.placeholder:altspaceutil.behaviors.NativeComponentPlaceholderMesh.clone(),this.object3d.add(this.placeholder)}this.defaults&&this.defaults.initComponent&&this.defaults.initComponent.bind(this)(),this.config.useCollider||(this.component.userData.altspace=this.component.userData.altspace||{},this.component.userData.altspace.collider=this.component.userData.altspace.collider||{},this.component.userData.altspace.collider.enabled=!1);var a=!1;if(this.config.inheritParentData&&!this.parent)for(var s=this.object3d.parent;s;){var i=s.getBehaviorByType(this.type);if(i){this.parent=i.parent||i,a=!0;break}s=s.parent}this.update(),!this.config.recursive&&!this.config.recursiveMesh||this.parent&&!a||this.object3d.traverse(function(t){t!==this.object3d&&t!==this.placeholder&&(this.config.recursive||this.config.recursiveMesh&&t instanceof THREE.Mesh)&&(t.getBehaviorByType(this.type)||t.addBehavior(Object.assign(new altspaceutil.behaviors.NativeComponent(this.type,this.data,this.config),{parent:this})))}.bind(this))},this.update=function(){if(this.placeholder&&(this.object3d.userData.altspace&&(this.placeholder.userData.altspace=this.object3d.userData.altspace),this.placeholder.visible=this.object3d.visible),this.parent&&this.config.inheritParentData&&(this.data=Object.assign({},this.parent.data)),this.parent||!this.config.recursive&&!this.config.recursiveMesh||this.object3d.traverse(function(t){t!==this.object3d&&t!==this.placeholder&&(this.config.recursive||this.config.recursiveMesh&&t instanceof THREE.Mesh)&&(t.getBehaviorByType(this.type)||t.addBehavior(Object.assign(new altspaceutil.behaviors.NativeComponent(this.type,this.data,this.config),{parent:this})))}.bind(this)),altspace.inClient){if(!this.initialized){if(!this.config.meshComponent||this.object3d instanceof THREE.Mesh)this.initialized=!0;else if(this.config.sharedComponent&&this.sharedData)for(var t of this.sharedData.behaviors)if(t.initialized){this.initialized=!0;break}this.initialized&&altspace.addNativeComponent(this.component,this.type)}if(this.config.sendUpdates)if(this.config.updateOnStaleData){var e=JSON.stringify(this.data);this.oldData!==e&&(this.defaults&&this.defaults.update?this.defaults.update.bind(this)():this.initialized&&altspace.updateNativeComponent(this.component,this.type,this.data),this.oldData=e)}else this.defaults&&this.defaults.update?this.defaults.update.bind(this)():this.initialized&&altspace.updateNativeComponent(this.component,this.type,this.data)}else{if(!this.initialized)if(!this.config.meshComponent||this.object3d instanceof THREE.Mesh)this.initialized=!0;else if(this.config.sharedComponent&&this.sharedData)for(var t of this.sharedData.behaviors)if(t.initialized){this.initialized=!0;break}this.defaults&&this.defaults.shimUpdate&&this.defaults.shimUpdate.bind(this)()}},this.callComponent=function(t,e){this.callComponentAction(t,e)},this.callComponentAction=function(t,e){this.initialized&&this.component&&(this.defaults&&this.defaults.callComponentAction?this.defaults.callComponentAction.bind(this)(t,e):altspace.callNativeComponentAction(this.component,this.type,t,e))},this.callComponentFunc=function(t,e){return this.initialized&&this.component?this.defaults&&this.defaults.callComponentFunc?this.defaults.callComponentFunc.bind(this)(t,e):altspace.callNativeComponentFunc(this.component,this.type,t,e):Promise.reject()},this.dispose=function(){this.shimbehavior&&this.object3d&&this.object3d.removeBehavior(this.shimbehavior),(this.config.recursive||this.config.recursiveMesh&&!this.parent)&&this.object3d.traverse(function(t){if(t!==this.object3d&&t!==this.placeholder&&(this.config.recursive||this.config.recursiveMesh&&t instanceof THREE.Mesh)){var e=t.getBehaviorByType(this.type);e&&e.parent===this&&t.removeBehavior(e)}}.bind(this));for(var t in this.nativeEvents)this.nativeEvents.hasOwnProperty(t)&&this.nativeEvents[t].clear();if(this.initialized&&(this.defaults&&this.defaults.dispose&&this.defaults.dispose.bind(this)(),altspace.removeNativeComponent(this.component,this.type)),this.config.sharedComponent&&this.sharedData){var e=this.sharedData.behaviors.indexOf(this);e>=0&&this.sharedData.behaviors.splice(e,1),this.sharedData.behaviors.length<=0&&(this.sharedData.placeholder.parent&&this.sharedData.placeholder.parent.remove(this.sharedData.placeholder),delete this.object3d.userData._sharedNativeComponent)}else this.placeholder&&this.object3d.remove(this.placeholder);this.nativeEvents={},this.initialized=!1,this.object3d=null,this.placeholder=null,this.component=null,this.scene=null,this.sharedData=null,this.oldData=null,this.parent=null,this.shimbehavior=null},this.getAttribute=function(t){return this.attributes[t]},this.clone=function(){return new altspaceutil.behaviors.NativeComponent(this.type,this.data,this.config)}},altspaceutil.behaviors.NativeComponentSync=function(t,e){this.componentType=t||"NativeComponent",this.type=t?"sync-"+t:"NativeComponentSync",this.config=e||{},this.awake=function(t){this.object3d=t,altspaceutil.manageBehavior(this,this.object3d),this.component=this.object3d.getBehaviorByType(this.componentType),this.sync=this.config.syncRef||this.object3d.getBehaviorByType("Object3DSync"),this.dataRef=this.sync.dataRef.child(this.componentType).child("data"),this.dataRefUpdate=this.dataRef.on("value",function(t){if(!this.sync.isMine){var e=t.val();if(e)return this.component||(this.component=this.object3d.getBehaviorByType(this.componentType),this.component)?void(this.component.data=e):(this.component=new altspaceutil.behaviors.NativeComponent(this.componentType,e),void this.object3d.addBehavior(this.component))}}.bind(this)),this.intervalId=setInterval(this.update.bind(this),this.sync.autoSendRateMS)},this.update=function(){if(this.sync.isMine&&this.component){var t=JSON.stringify(this.component.data);this.oldData!==t&&(this.dataRef.set(this.component.data),this.oldData=t)}},this.dispose=function(){this.intervalId&&clearInterval(this.intervalId),this.dataRefUpdate&&this.dataRef&&this.dataRef.off("value",this.dataRefUpdate),this.object3d=null,this.component=null,this.sync=null,this.dataRef=null,this.dataRefUpdate=null,this.oldData=null},this.clone=function(){return new altspaceutil.behaviors.NativeComponentSync(this.componentType,this.config)}};