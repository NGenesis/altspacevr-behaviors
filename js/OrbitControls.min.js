"use strict";window.altspaceutil=window.altspaceutil||{},altspaceutil.behaviors=altspaceutil.behaviors||{},altspaceutil.addNativeEventListener=function(e,a){return altspace.inClient&&altspace._internal&&altspace._internal.couiEngine?altspace._internal.couiEngine.on(e,a):null},altspaceutil.removeNativeEventListener=function(e,a){altspace.inClient&&altspace._internal&&altspace._internal.couiEngine&&altspace._internal.couiEngine.off(e,a)},altspaceutil.removeAllNativeEventListeners=function(e){altspace.inClient&&altspace._internal&&altspace._internal.couiEngine&&altspace._internal.couiEngine.events[e]&&delete altspace._internal.couiEngine.events[e]},altspaceutil.getObject3DById=function(e){return altspace.inClient&&altspace._internal?altspace._internal.getObject3DById(e):null},altspaceutil.getThreeJSScene=function(){return altspace.inClient&&altspace._internal?altspace._internal.getThreeJSScene():null},altspaceutil.expandSerializationBuffer=function(e){altspace.inClient&&altspace._internal&&altspace._internal.ScratchThriftBuffer&&e>0&&altspace._internal.ScratchThriftBuffer.grow(e)},altspaceutil.profileSerializationBuffer=function(e){altspace.inClient&&altspace._internal&&altspace._internal.ScratchThriftBuffer&&(altspace._internal.ScratchThriftBuffer.profile=void 0===e||e)},altspaceutil.isMobileApp=function(e){return/mobile/i.test(navigator.userAgent)},altspaceutil.getFullspaceEnclosure=function(){return new Promise(function(e,a){altspace.getEnclosure().then(function(t){t.requestFullspace().then(function(){t.addEventListener("fullspacechange",function(){t.fullspace||t.requestFullspace().catch(function(){a("enclosure.requestFullspace() after fullspacechange event failed")})}),e(t)}).catch(function(){a("enclosure.requestFullspace() failed")})}).catch(function(){a("altspace.getEnclosure() failed")})})},altspaceutil.getAbsoluteURL=function(e){return new URL(e,window.location).toString()},altspaceutil.getBasePath=function(e){return e.split("/").slice(0,-1).join("/")+"/"},altspaceutil.loadTexture=function(e,a){if(altspace.inClient)return new THREE.Texture({src:altspaceutil.getAbsoluteURL(e)});a=Object.assign({crossOrigin:"anonymous"},a);var t=new THREE.TextureLoader;return"anonymous"!==a.crossOrigin&&t.setCrossOrigin(a.crossOrigin),void 0!==a.withCredentials&&t.setWithCredentials(a.withCredentials),void 0!==a.path&&t.setPath(a.path),t.load(e)},altspaceutil.setCursorCollider=function(e,a,t){e&&(t?e.traverse(e=>{e.userData.altspace||(e.userData.altspace={}),e.userData.altspace.collider||(e.userData.altspace.collider={}),e.userData.altspace.collider.enabled=a}):(e.userData.altspace||(e.userData.altspace={}),e.userData.altspace.collider||(e.userData.altspace.collider={}),e.userData.altspace.collider.enabled=a))},altspaceutil.isCursorCollider=function(e){return!!e&&(!e.userData.altspace||!e.userData.altspace.collider||void 0===e.userData.altspace.enabled||e.userData.altspace.enabled)},altspaceutil.manageBehavior=function(e,a){e.__isManaged=!0,a.__resetManagedBehavior||a.addEventListener("removed",a.__resetManagedBehavior=function(){a.__resetManagedBehavior&&(a.removeEventListener("removed",a.__resetManagedBehavior),a.__resetManagedBehavior=null),a.traverse(function(e){if(e.__behaviorList)for(var a of e.__behaviorList)if(a.__isInitialized&&a.__isManaged)try{a.dispose&&a.dispose.call(a,e),a.__isInitialized=!1}catch(t){console.group(),(console.error||console.log).call(console,t.stack||t),console.log("[Behavior]"),console.log(a),console.log("[Object3D]"),console.log(e),console.groupEnd()}})})},altspaceutil.unmanageBehavior=function(e,a){e.__isManaged=!1},altspaceutil.cloneWithBehaviors=function(e,a){var t=e.clone(!1);if(e.__behaviorList&&e.__behaviorList.length>0)for(var n of e.__behaviorList)try{if(n.clone){var l=n.clone.call(n,t,e);l&&(t.__behaviorList=t.__behaviorList||[],t.__behaviorList.push(l))}}catch(a){console.group(),(console.error||console.log).call(console,a.stack||a),console.log("[Behavior]"),console.log(n),console.log("[Object3D]"),console.log(e),console.groupEnd()}if(void 0===a||a)for(var i of e.children)t.add(i.cloneWithBehaviors(!0));return t},altspaceutil.behaviors.OrbitControls=function(){this.type="OrbitControls",this.awake=function(e){altspace.inClient||(this.controls=new THREE.OrbitControls(e)),altspaceutil.manageBehavior(this,e)},this.update=function(e){altspace.inClient||this.controls.update()},this.dispose=function(){this.controls=null}};