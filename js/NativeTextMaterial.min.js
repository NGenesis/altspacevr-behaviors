"use strict";window.altspaceutil=window.altspaceutil||{},altspaceutil.behaviors=altspaceutil.behaviors||{},altspaceutil.addNativeEventListener=function(t,e){return altspace.inClient&&altspace._internal&&altspace._internal.couiEngine?altspace._internal.couiEngine.on(t,e):null},altspaceutil.removeNativeEventListener=function(t,e){altspace.inClient&&altspace._internal&&altspace._internal.couiEngine&&altspace._internal.couiEngine.off(t,e)},altspaceutil.removeAllNativeEventListeners=function(t){altspace.inClient&&altspace._internal&&altspace._internal.couiEngine&&altspace._internal.couiEngine.events[t]&&delete altspace._internal.couiEngine.events[t]},altspaceutil.getObject3DById=function(t){return altspace.inClient&&altspace._internal?altspace._internal.getObject3DById(t):null},altspaceutil.getThreeJSScene=function(){return altspace.inClient&&altspace._internal?altspace._internal.getThreeJSScene():null},altspaceutil.expandSerializationBuffer=function(t){altspace.inClient&&altspace._internal&&altspace._internal.ScratchThriftBuffer&&t>0&&altspace._internal.ScratchThriftBuffer.grow(t)},altspaceutil.profileSerializationBuffer=function(t){altspace.inClient&&altspace._internal&&altspace._internal.ScratchThriftBuffer&&(altspace._internal.ScratchThriftBuffer.profile=void 0===t||t)},altspaceutil.isMobileApp=function(t){return/mobile/i.test(navigator.userAgent)},altspaceutil.getFullspaceEnclosure=function(){return new Promise(function(t,e){altspace.getEnclosure().then(function(a){a.requestFullspace().then(function(){a.addEventListener("fullspacechange",function(){a.fullspace||a.requestFullspace().catch(function(){e("enclosure.requestFullspace() after fullspacechange event failed")})}),t(a)}).catch(function(){e("enclosure.requestFullspace() failed")})}).catch(function(){e("altspace.getEnclosure() failed")})})},altspaceutil.getAbsoluteURL=function(t){return new URL(t,window.location).toString()},altspaceutil.getBasePath=function(t){return t.split("/").slice(0,-1).join("/")+"/"},altspaceutil.loadTexture=function(t,e){if(altspace.inClient)return new THREE.Texture({src:altspaceutil.getAbsoluteURL(t)});e=Object.assign({crossOrigin:"anonymous"},e);var a=new THREE.TextureLoader;return"anonymous"!==e.crossOrigin&&a.setCrossOrigin(e.crossOrigin),void 0!==e.withCredentials&&a.setWithCredentials(e.withCredentials),void 0!==e.path&&a.setPath(e.path),a.load(t)},altspaceutil.setCursorCollider=function(t,e,a){t&&(a?t.traverse(t=>{t.userData.altspace||(t.userData.altspace={}),t.userData.altspace.collider||(t.userData.altspace.collider={}),t.userData.altspace.collider.enabled=e}):(t.userData.altspace||(t.userData.altspace={}),t.userData.altspace.collider||(t.userData.altspace.collider={}),t.userData.altspace.collider.enabled=e))},altspaceutil.isCursorCollider=function(t){return!!t&&(!t.userData.altspace||!t.userData.altspace.collider||void 0===t.userData.altspace.enabled||t.userData.altspace.enabled)},altspaceutil.manageBehavior=function(t,e){t.__isManaged=!0,e.__resetManagedBehavior||e.addEventListener("removed",e.__resetManagedBehavior=function(){e.__resetManagedBehavior&&(e.removeEventListener("removed",e.__resetManagedBehavior),e.__resetManagedBehavior=null),e.traverse(function(t){if(t.__behaviorList)for(var e of t.__behaviorList)if(e.__isInitialized&&e.__isManaged)try{e.dispose&&e.dispose.call(e,t),e.__isInitialized=!1}catch(a){console.group(),(console.error||console.log).call(console,a.stack||a),console.log("[Behavior]"),console.log(e),console.log("[Object3D]"),console.log(t),console.groupEnd()}})})},altspaceutil.unmanageBehavior=function(t,e){t.__isManaged=!1},altspaceutil.cloneWithBehaviors=function(t,e){var a=t.clone(!1);if(t.__behaviorList&&t.__behaviorList.length>0)for(var i of t.__behaviorList)try{if(i.clone){var n=i.clone.call(i,a,t);n&&(a.__behaviorList=a.__behaviorList||[],a.__behaviorList.push(n))}}catch(e){console.group(),(console.error||console.log).call(console,e.stack||e),console.log("[Behavior]"),console.log(i),console.log("[Object3D]"),console.log(t),console.groupEnd()}if(void 0===e||e)for(var l of t.children)a.add(l.cloneWithBehaviors(!0));return a},altspaceutil.behaviors.NativeTextMaterial=function(t){t=t||{},this.type="NativeTextMaterial",this.awake=function(e){this.object3d=e,this.component=this.object3d.getBehaviorByType("n-text"),this.material=t.material||this.object3d.material||new THREE.MeshBasicMaterial({transparent:!0}),this.hasColor=void 0===t.color||t.color,this.hasOpacity=void 0===t.opacity||t.opacity},this.update=function(t){this.removeMaterialTags(),this.component.data.text=this.getMaterialTags()+this.component.data.text},this.dispose=function(){this.removeMaterialTags()},this.removeMaterialTags=function(){var t=this.component.data.text.indexOf('<link id="n-text-material">'),e=t>=0?this.component.data.text.indexOf("</link>",t):-1;t>=0&&e>=0&&(this.component.data.text=this.component.data.text.slice(0,t)+this.component.data.text.slice(e+7))},this.getMaterialTags=function(){var t='<link id="n-text-material">';return this.hasColor?t+="<color=#"+this.getColorHexString()+this.getOpacityHexString()+">":this.hasOpacity&&(t+="<alpha=#"+this.getOpacityHexString()+">"),t+="</link>"},this.getColorHexString=function(){return this.material.color.getHexString()},this.getOpacityHexString=function(){var t=(+Math.floor(this.hasOpacity&&this.material.transparent?255*this.material.opacity:255)).toString(16).toUpperCase();return t.length<2&&(t="0"+t),t}},window.AFRAME&&(AFRAME.components["n-text-material"]&&delete AFRAME.components["n-text-material"],AFRAME.registerComponent("n-text-material",{dependencies:["n-text"],schema:{material:{type:"selector"},color:{type:"boolean",default:!0},opacity:{type:"boolean",default:!0}},init:function(){this.component=this.el.getAttribute("n-text"),this.material=this.data.material?this.data.material.object3DMap.mesh.material:this.el.object3DMap.mesh.material},remove:function(){this.removeMaterialTags()},tick:function(t){this.removeMaterialTags(),this.el.setAttribute("n-text","text",this.getMaterialTags()+this.component.text)},removeMaterialTags:function(){var t=this.component.text.indexOf('<link id="n-text-material">'),e=t>=0?this.component.text.indexOf("</link>",t):-1;t>=0&&e>=0&&(this.component.text=this.component.text.slice(0,t)+this.component.text.slice(e+7))},getMaterialTags:function(){var t='<link id="n-text-material">';return this.data.color?t+="<color=#"+this.getColorHexString()+this.getOpacityHexString()+">":this.data.opacity&&(t+="<alpha=#"+this.getOpacityHexString()+">"),t+="</link>"},getColorHexString:function(){return this.material.color.getHexString()},getOpacityHexString:function(){var t=(+Math.floor(this.data.opacity&&this.material.transparent?255*this.material.opacity:255)).toString(16).toUpperCase();return t.length<2&&(t="0"+t),t}}));