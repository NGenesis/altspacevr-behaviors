"use strict";function initCollisionEventHandler(){altspace.inClient&&this.placeholder&&(this.nativeEvents.NativeCollisionEvent=altspaceutil.addNativeEventListener("NativeCollisionEvent",function(t,e,i,s,a,n,o,r,l,h,c,d){var u=altspaceutil.getObject3DById(e),p=altspaceutil.getObject3DById(i);if(u===this.placeholder||p===this.placeholder){var g={type:t,bubbles:!0,target:u===this.placeholder?this.object3d:u,other:p===this.placeholder?this.object3d:p,relativeVelocity:{x:s,y:a,z:n}};o&&(g.point={position:{x:h,y:c,z:d},normal:{x:o,y:r,z:l}}),this.object3d.dispatchEvent(g)}}.bind(this)),this.nativeEvents.NativeTriggerEvent=altspaceutil.addNativeEventListener("NativeTriggerEvent",function(t,e,i){var s=altspaceutil.getObject3DById(e),a=altspaceutil.getObject3DById(i);if(s===this.placeholder||a===this.placeholder){var n={type:t,bubbles:!0,target:s===this.placeholder?this.object3d:s,other:a===this.placeholder?this.object3d:a};this.object3d.dispatchEvent(n)}}.bind(this)))}window.altspaceutil=window.altspaceutil||{},altspaceutil.behaviors=altspaceutil.behaviors||{},altspaceutil.addNativeEventListener=function(t,e){return altspace.inClient&&altspace._internal&&altspace._internal.couiEngine?altspace._internal.couiEngine.on(t,e):null},altspaceutil.removeNativeEventListener=function(t,e){altspace.inClient&&altspace._internal&&altspace._internal.couiEngine&&altspace._internal.couiEngine.off(t,e)},altspaceutil.removeAllNativeEventListeners=function(t){altspace.inClient&&altspace._internal&&altspace._internal.couiEngine&&altspace._internal.couiEngine.events[t]&&delete altspace._internal.couiEngine.events[t]},altspaceutil.getObject3DById=function(t){return altspace.inClient&&altspace._internal?altspace._internal.getObject3DById(t):null},altspaceutil.getThreeJSScene=function(){return altspace.inClient&&altspace._internal?altspace._internal.getThreeJSScene():null},altspaceutil.expandSerializationBuffer=function(t){altspace.inClient&&altspace._internal&&altspace._internal.ScratchThriftBuffer&&t>0&&altspace._internal.ScratchThriftBuffer.grow(t)},altspaceutil.profileSerializationBuffer=function(t){altspace.inClient&&altspace._internal&&altspace._internal.ScratchThriftBuffer&&(altspace._internal.ScratchThriftBuffer.profile=void 0===t||t)},altspaceutil.isMobileApp=function(t){return/mobile/i.test(navigator.userAgent)},altspaceutil.getFullspaceEnclosure=function(){let t=altspace.inClient?altspace.getEnclosure:()=>{return altspaceutil._BrowserEnclosure||(altspaceutil._BrowserEnclosure=new class extends THREE.EventDispatcher{constructor(){super(),this.innerWidth=1280,this.innerHeight=720,this.innerDepth=1280,this.pixelsPerMeter=1,this.hasFocus=document.hasFocus(),this.fullspace=!0,window.addEventListener("focus",()=>this.hasFocus=document.hasFocus()),window.addEventListener("blur",()=>this.hasFocus=document.hasFocus())}requestFullspace(){return this.fullspace||(this.fullspace=!0,this.dispatchEvent({type:"fullspacechange"})),Promise.resolve()}exitFullspace(){return this.fullspace&&(this.fullspace=!1,this.dispatchEvent({type:"fullspacechange"})),Promise.resolve()}}),Promise.resolve(altspaceutil._BrowserEnclosure)};return new Promise((e,i)=>{t().then(t=>t.requestFullspace().then(()=>{t.addEventListener("fullspacechange",()=>{t.fullspace||t.requestFullspace().catch(()=>i("enclosure.requestFullspace() after fullspacechange event failed"))}),e(t)})).catch(()=>i("Failed to get fullspace enclosure."))})},altspaceutil.getFullspaceAppManifest=function(){if(altspaceutil._fullspaceAppManifest)return Promise.resolve(altspaceutil._fullspaceAppManifest);let t=new URLSearchParams(window.location.search),e=e=>{for(let i of t.entries())if(/altvr\.enclosure\.(.*)/i.test(i[0])){let t=i[0].match(/altvr\.enclosure\.(.*)/i)[1],s=e.enclosure=Object.assign({},e.enclosure);switch(s.position=Object.assign({x:0,y:0,z:0},s.position),s.rotation=Object.assign({x:0,y:0,z:0},s.rotation),s.scale=s.hasOwnProperty("scale")&&"number"==typeof s.scale?{x:s.scale||1,y:anchormanifeste.scale||1,z:s.scale||1}:Object.assign({x:1,y:1,z:1},s.scale),t){case"position":case"rotation":{let e=i[1].split(",");e.length>=1&&(s[t].x=parseFloat(e[0])||0),e.length>=2&&(s[t].y=parseFloat(e[1])||0),e.length>=3&&(s[t].z=parseFloat(e[2])||0);break}case"scale":{let e=i[1].split(",");1===e.length?s[t].x=s[t].y=s[t].z=parseFloat(e[0])||1:(e.length>=1&&(s[t].x=parseFloat(e[0])||1),e.length>=2&&(s[t].y=parseFloat(e[1])||1),e.length>=3&&(s[t].z=parseFloat(e[2])||1));break}}}else if(/altvr\.anchors\.(.*)\.(.*)/i.test(i[0])){let[,t,s]=i[0].match(/altvr\.anchors\.(.*)\.(.*)/i),a=e.anchors.findIndex(e=>{return e.name===t});switch(a<0&&(a=e.anchors.push({name:t})-1),anchormanifest=e.anchors[a]=Object.assign({name:t},e.anchors[a]),anchormanifest.position=Object.assign({x:0,y:0,z:0},anchormanifest.position),anchormanifest.rotation=Object.assign({x:0,y:0,z:0},anchormanifest.rotation),anchormanifest.scale=anchormanifest.hasOwnProperty("scale")&&"number"==typeof anchormanifest.scale?{x:anchormanifest.scale||1,y:anchormanifeste.scale||1,z:anchormanifest.scale||1}:Object.assign({x:1,y:1,z:1},anchormanifest.scale),s){case"position":case"rotation":{let t=i[1].split(",");t.length>=1&&(anchormanifest[s].x=parseFloat(t[0])||0),t.length>=2&&(anchormanifest[s].y=parseFloat(t[1])||0),t.length>=3&&(anchormanifest[s].z=parseFloat(t[2])||0);break}case"scale":{let t=i[1].split(",");1===t.length?anchormanifest[s].x=anchormanifest[s].y=anchormanifest[s].z=parseFloat(t[0])||1:(t.length>=1&&(anchormanifest[s].x=parseFloat(t[0])||1),t.length>=2&&(anchormanifest[s].y=parseFloat(t[1])||1),t.length>=3&&(anchormanifest[s].z=parseFloat(t[2])||1));break}}}};return t.has("altvr.manifest")&&t.get("altvr.manifest").length>0?new Promise((i,s)=>{fetch(altspaceutil.getAbsoluteURL(t.get("altvr.manifest"))).then(t=>t.json()).then(t=>{altspaceutil._fullspaceAppManifest=t,e(altspaceutil._fullspaceAppManifest),i(altspaceutil._fullspaceAppManifest)}).catch(()=>s("Failed to download manifest from "+t.get("altvr.manifest")))}):(altspaceutil._fullspaceAppManifest={enclosure:{position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scale:{x:1,y:1,z:1}},anchors:[]},e(altspaceutil._fullspaceAppManifest),Promise.resolve(altspaceutil._fullspaceAppManifest))},altspaceutil.FullspaceApp=class{constructor(t){this.config=Object.assign({serializationBufferSize:5e5},t),this.config.serializationBufferSize&&altspaceutil.expandSerializationBuffer(this.config.serializationBufferSize)}initialize(){let t=()=>{return this._isInitializing||this._isInitialized?new Promise((t,e)=>{let i=setInterval(()=>{this._isInitializing||(clearInterval(i),t())},10)}):(this._isInitializing=!0,Promise.resolve())},e=altspace.inClient?altspace.getSpace():Promise.resolve({sid:"browser",name:"Web Space",templateSid:"browser"});return new Promise((i,s)=>{t().then(()=>{return this._isInitialized?i(this):(this._isInitializing=!0,Promise.all([altspaceutil.getFullspaceEnclosure(),altspaceutil.getFullspaceAppManifest(),e]).then(t=>{let[e,s,a]=t;if(this._enclosure=e,this._manifest=s,this._space=a,this._scene=new THREE.Scene,this._camera=new THREE.PerspectiveCamera,altspace.inClient)this._renderer=altspace.getThreeJSRenderer();else{this._renderer=new THREE.WebGLRenderer({antialias:!0}),Object.assign(this._camera,{fov:90,near:1,far:2e3}),this._camera.position.z=20;let t=()=>{this._renderer.setClearColor("#99AACC"),document.body.style.margin="0px",document.body.style.overflow="hidden",document.body.appendChild(this._renderer.domElement)};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",t):t();let e=()=>{this._camera.aspect=window.innerWidth/window.innerHeight,this._camera.updateProjectionMatrix(),this._renderer.setSize(window.innerWidth,window.innerHeight)};window.addEventListener("resize",e),e(),this._scene.add(this._camera),this._scene.add(new THREE.AmbientLight("white")),altspace.utilities.shims.cursor.init(this._scene,this._camera,{renderer:this._renderer})}this._anchors={},this._anchor=Object.assign(new THREE.Group,{name:"altvr.enclosure"}),this._scene.add(this._anchor);let n=this._manifest?this._manifest.enclosure:null;n&&(this._anchor.position.copy(n.position),this._anchor.rotation.set(THREE.Math.degToRad(n.rotation.x),THREE.Math.degToRad(n.rotation.y),THREE.Math.degToRad(n.rotation.z)),this._anchor.scale.copy(n.scale)),this._anchorsGroup=Object.assign(new THREE.Group,{name:"altvr.anchors"}),this._anchorsGroup.addBehavior(new class t{get type(){return"_ApplyAppAnchorTransform"}constructor(t){this.anchor=t}awake(t){this.object3d=t,this.object3d.position.copy(this.anchor.position),this.object3d.quaternion.copy(this.anchor.quaternion),this.object3d.scale.copy(this.anchor.scale)}update(){this.object3d.position.copy(this.anchor.position),this.object3d.quaternion.copy(this.anchor.quaternion),this.object3d.scale.copy(this.anchor.scale)}}(this._anchor)),this._scene.add(this._anchorsGroup),this._isInitialized=!0;let o=()=>{window.requestAnimationFrame(o),this._scene.updateAllBehaviors(),this._renderer.render(this._scene,this._camera)};o(),this._isInitializing=!1,i(this)}))}).catch(()=>{this._isInitializing=!1,s("Failed to initialize fullspace app.")})})}anchors(t){if(this._anchors[t])return this._anchors[t];let e=this._anchors[t]=Object.assign(new THREE.Group,{name:t});this._anchorsGroup.add(e);let i=this._manifest.anchors.find(e=>{return e.name===t});return i&&(e.position.copy(i.position),e.rotation.set(THREE.Math.degToRad(i.rotation.x),THREE.Math.degToRad(i.rotation.y),THREE.Math.degToRad(i.rotation.z)),e.scale.copy(i.scale)),e}get scene(){return this._scene}get renderer(){return this._renderer}get camera(){return this._camera}get anchor(){return this._anchor}get enclosure(){return this._enclosure}get space(){return this._space}},altspaceutil.getFullspaceApp=function(t){return altspaceutil._fullspaceApp||(altspaceutil._fullspaceApp=new altspaceutil.FullspaceApp(t)),altspaceutil._fullspaceApp.initialize()},altspaceutil.getAbsoluteURL=function(t){return new URL(t,window.location).toString()},altspaceutil.getBasePath=function(t){return t.split("/").slice(0,-1).join("/")+"/"},altspaceutil.loadTexture=function(t,e){if(altspace.inClient)return new THREE.Texture({src:altspaceutil.getAbsoluteURL(t)});e=Object.assign({crossOrigin:"anonymous"},e);var i=new THREE.TextureLoader;return"anonymous"!==e.crossOrigin&&i.setCrossOrigin(e.crossOrigin),void 0!==e.withCredentials&&i.setWithCredentials(e.withCredentials),void 0!==e.path&&i.setPath(e.path),i.load(t)},altspaceutil.setCursorCollider=function(t,e,i){t&&(i?t.traverse(t=>{t.userData.altspace||(t.userData.altspace={}),t.userData.altspace.collider||(t.userData.altspace.collider={}),t.userData.altspace.collider.enabled=e}):(t.userData.altspace||(t.userData.altspace={}),t.userData.altspace.collider||(t.userData.altspace.collider={}),t.userData.altspace.collider.enabled=e))},altspaceutil.isCursorCollider=function(t){return!!t&&(!t.userData.altspace||!t.userData.altspace.collider||void 0===t.userData.altspace.enabled||t.userData.altspace.enabled)},altspaceutil.manageBehavior=function(t,e){t.__isManaged=!0,e.__resetManagedBehavior||e.addEventListener("removed",e.__resetManagedBehavior=function(){e.__resetManagedBehavior&&(e.removeEventListener("removed",e.__resetManagedBehavior),e.__resetManagedBehavior=null),e.traverse(function(t){if(t.__behaviorList)for(var e of t.__behaviorList)if(e.__isInitialized&&e.__isManaged)try{e.dispose&&e.dispose.call(e,t),e.__isInitialized=!1}catch(i){console.group(),(console.error||console.log).call(console,i.stack||i),console.log("[Behavior]"),console.log(e),console.log("[Object3D]"),console.log(t),console.groupEnd()}})})},altspaceutil.unmanageBehavior=function(t,e){t.__isManaged=!1},altspaceutil.cloneWithBehaviors=function(t,e){var i=t.clone(!1);if(t.__behaviorList&&t.__behaviorList.length>0)for(var s of t.__behaviorList)try{if(s.clone){var a=s.clone.call(s,i,t);a&&(i.__behaviorList=i.__behaviorList||[],i.__behaviorList.push(a))}}catch(e){console.group(),(console.error||console.log).call(console,e.stack||e),console.log("[Behavior]"),console.log(s),console.log("[Object3D]"),console.log(t),console.groupEnd()}if(void 0===e||e)for(var n of t.children)i.add(n.cloneWithBehaviors(!0));return i},altspaceutil.loadScript=((t,e)=>{if(e=Object.assign({loadOnce:!0},e),altspaceutil._loadedScripts=altspaceutil._loadedScripts||{},e.scriptTest&&e.scriptTest(t))return Promise.resolve();if(e.loadOnce){if(altspaceutil._loadedScripts[t]&&altspaceutil._loadedScripts[t].loaded)return Promise.resolve();if(altspaceutil._loadedScripts[t]&&altspaceutil._loadedScripts[t].waiting)return altspaceutil._loadedScripts[t].waiting}let i=document.createElement("script");i.src=new URL(t,window.location).toString(),i.async=!1;let s=void 0===altspaceutil._loadedScripts[t],a=new Promise((a,n)=>{i.onload=(()=>{!e.scriptTest||e.scriptTest(t)?a():(console.warn("Script test failed for script at "+i.src),n("Script test failed for script at "+i.src)),s&&(altspaceutil._loadedScripts[t].loaded=!0,altspaceutil._loadedScripts[t].waiting=null)}),i.onerror=(()=>{s&&(altspaceutil._loadedScripts[t].waiting=null,delete altspaceutil._loadedScripts[t]),console.warn("Failed to load script at "+i.src),n("Failed to load script at "+i.src)})});if(s&&(altspaceutil._loadedScripts[t]={waiting:a}),altspaceutil._lastLoadScript)altspaceutil._lastLoadScript.parentNode.insertBefore(i,altspaceutil._lastLoadScript.nextSibling);else{let t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(i,t)}return altspaceutil._lastLoadScript=i,a}),altspaceutil.loadScripts=(t=>{return!t||t.length<=0?Promise.resolve():Promise.all(t.map(t=>"string"==typeof t||t instanceof String?altspaceutil.loadScript(t):altspaceutil.loadScript(t.url,t)))}),altspaceutil.behaviors.TWEEN=function(t){this.type="TWEEN",this.group=t||TWEEN,this.update=function(t){this.group&&this.group.update()},this.dispose=function(){this.removeAll()},this.removeAll=function(){this.group&&this.group.removeAll()},this.getAll=function(){return this.group?this.group.getAll():null},this.add=function(t){this.group&&this.group.add(t)},this.remove=function(t){this.group&&this.group.remove(t)}},altspaceutil.behaviors.NativeComponentPlaceholderMesh=altspaceutil.behaviors.NativeComponentPlaceholderMesh||new THREE.Mesh(new THREE.BoxBufferGeometry(.001,.001,.001),Object.assign(new THREE.MeshBasicMaterial,{visible:!1})),altspaceutil.behaviors.NativeComponentDefaults={"n-object":{data:{res:"architecture/wall-4w-4h"}},"n-spawner":{data:{res:"interactables/basketball"}},"n-text":{data:{text:"",fontSize:10,width:10,height:1,horizontalAlign:"middle",verticalAlign:"middle"}},"n-sphere-collider":{data:{isTrigger:!1,center:{x:0,y:0,z:0},radius:0,type:"environment"},config:{meshComponent:!0},initComponent:initCollisionEventHandler},"n-box-collider":{data:{isTrigger:!1,center:{x:0,y:0,z:0},size:{x:0,y:0,z:0},type:"environment"},config:{meshComponent:!0},initComponent:initCollisionEventHandler},"n-capsule-collider":{data:{isTrigger:!1,center:{x:0,y:0,z:0},radius:0,height:0,direction:"y",type:"environment"},config:{meshComponent:!0},initComponent:initCollisionEventHandler},"n-mesh-collider":{data:{isTrigger:!1,convex:!0,type:"environment"},config:{recursiveMesh:!0,inheritParentData:!0,meshComponent:!0},initComponent:initCollisionEventHandler},"n-container":{data:{capacity:4},config:{meshComponent:!0},attributes:{count:0},initComponent:function(){if(altspace.inClient&&(this.nativeEvents.NativeContainerCountChanged=altspaceutil.addNativeEventListener("NativeContainerCountChanged",function(t,e,i){var s=altspaceutil.getObject3DById(t);s&&s===this.component&&(this.attributes.count=e,s.dispatchEvent({type:"container-count-changed",detail:{count:e,oldCount:i},bubbles:!0,target:s}))}.bind(this)),this.nativeEvents.NativeContainerStateChanged=altspaceutil.addNativeEventListener("NativeContainerStateChanged",function(t,e,i){var s=altspaceutil.getObject3DById(t);if(s&&s===this.component){var a=this.state;this.state=i?e:void 0,s.dispatchEvent({type:i?"stateadded":"stateremoved",detail:{state:e},bubbles:!0,target:s}),this.state!==a&&this.state&&s.dispatchEvent({type:e,bubbles:!0,target:s})}}.bind(this))),this.placeholder){var t=function(t){this.object3d.dispatchEvent(t)}.bind(this);this.placeholder.addEventListener("container-count-changed",t),this.placeholder.addEventListener("container-empty",t),this.placeholder.addEventListener("container-full",t),this.placeholder.addEventListener("triggerenter",t),this.placeholder.addEventListener("triggerexit",t)}}},"n-sound":{data:{on:"",res:"",src:"",loop:!1,volume:1,autoplay:!1,oneshot:!1,spatialBlend:1,pitch:1,minDistance:1,maxDistance:12},attributes:{loaded:!1},initComponent:function(){if(this.data.src=altspaceutil.getAbsoluteURL(this.data.src),altspace.inClient&&(altspaceutil.overrideNativeSoundLoadedEvent||(altspaceutil.overrideNativeSoundLoadedEvent=!0,altspaceutil.removeAllNativeEventListeners("NativeSoundLoadedEvent"),altspaceutil.addNativeEventListener("NativeSoundLoadedEvent",function(t){altspace._internal.forwardEventToChildIFrames("NativeSoundLoadedEvent",arguments);var e=altspace._internal.getObject3DById(t);e&&e.el&&targetEl.emit("n-sound-loaded",null,!0)})),this.nativeEvents.NativeSoundLoadedEvent=altspaceutil.addNativeEventListener("NativeSoundLoadedEvent",function(t){var e=altspaceutil.getObject3DById(t);e&&e===this.component&&(this.attributes.loaded=!0,e.dispatchEvent({type:"n-sound-loaded",bubbles:!0,target:e}))}.bind(this))),this.placeholder){var t=function(t){this.object3d.dispatchEvent(t)}.bind(this);this.placeholder.addEventListener("n-sound-loaded",t),this.placeholder.addEventListener("sound-paused",t),this.placeholder.addEventListener("sound-played",t)}},callComponentAction:function(t,e){"play"===t?this.component.dispatchEvent({type:"sound-played",bubbles:!0,target:this.component}):"pause"===t&&this.component.dispatchEvent({type:"sound-paused",bubbles:!0,target:this.component}),altspace.callNativeComponentAction(this.component,this.type,t,e)},update:function(){this.data.src=altspaceutil.getAbsoluteURL(this.data.src),this.attributes.loaded=!1,this.initialized&&altspace.updateNativeComponent(this.component,this.type,this.data),this.playHandlerType&&(this.component.removeEventListener(this.playHandlerType,this.playHandler),this.playHandlerType=null),this.data.on&&""!==this.data.on&&(void 0===this.playHandler&&(this.playHandler=this.callComponentAction.bind(this,"play")),this.playHandlerType=this.data.on,this.component.addEventListener(this.playHandlerType,this.playHandler))}},"n-skeleton-parent":{data:{part:"head",side:"center",index:0,userId:null},config:{recursiveMesh:!0,inheritParentData:!0,meshComponent:!0}},"n-cockpit-parent":{config:{sendUpdates:!1,recursiveMesh:!0,inheritParentData:!0,meshComponent:!0}},"n-billboard":{config:{sendUpdates:!1,meshComponent:!0}},"n-animator":{config:{sendUpdates:!1,meshComponent:!0}},"n-layout-browser":{data:{url:"about:blank",isEnclosure:!1},initComponent:function(){this.data.url=altspaceutil.getAbsoluteURL(this.data.url),this.scene.userData.altspace=this.scene.userData.altspace||{},this.scene.userData.altspace.initialized=!0},update:function(){this.data.url=altspaceutil.getAbsoluteURL(this.data.url),this.initialized&&altspace.updateNativeComponent(this.component,this.type,this.data)}},"n-portal":{data:{targetSpace:null,targetEvent:null,targetPosition:{x:0,y:0,z:0},targetQuaternion:{x:0,y:0,z:0,w:1}},update:function(){if(this.config.targetEntity){this.scene.updateMatrixWorld(!0),this.data.targetPosition=this.config.targetEntity.getWorldPosition(new THREE.Vector3);var t=this.config.targetEntity.getWorldQuaternion(new THREE.Quaternion);this.data.targetQuaternion={x:t.x,y:t.y,z:t.z,w:t.w}}this.initialized&&altspace.updateNativeComponent(this.component,this.type,this.data)}},"n-gltf":{data:{url:"",sceneIndex:0},attributes:{loaded:!1},initComponent:function(){if(this.data.url=altspaceutil.getAbsoluteURL(this.data.url),altspace.inClient&&(altspaceutil.overrideNativeGLTFLoadedEvent||(altspaceutil.overrideNativeGLTFLoadedEvent=!0,altspaceutil.removeAllNativeEventListeners("NativeGLTFLoadedEvent"),altspaceutil.addNativeEventListener("NativeGLTFLoadedEvent",function(t){altspace._internal.forwardEventToChildIFrames("NativeGLTFLoadedEvent",arguments);var e=altspace._internal.getObject3DById(t);e&&e.el&&targetEl.emit("n-gltf-loaded",null,!0)})),this.nativeEvents.NativeGLTFLoadedEvent=altspaceutil.addNativeEventListener("NativeGLTFLoadedEvent",function(t){var e=altspaceutil.getObject3DById(t);e&&e===this.component&&(this.attributes.loaded=!0,e.dispatchEvent({type:"n-gltf-loaded",bubbles:!0,target:e}))}.bind(this))),this.placeholder){var t=function(t){this.object3d.dispatchEvent(t)}.bind(this);this.placeholder.addEventListener("n-gltf-loaded",t)}},update:function(){this.data.url=altspaceutil.getAbsoluteURL(this.data.url),this.attributes.loaded=!1,this.initialized&&altspace.updateNativeComponent(this.component,this.type,this.data)},callComponentFunc:function(t,e){return altspace.callNativeComponentFunc(this.component,this.type,t,e).then(function(e){return"GetBoundingBox"===t?new THREE.Box3((new THREE.Vector3).subVectors(e.center,e.extents),(new THREE.Vector3).addVectors(e.center,e.extents)):e})}},"n-rigidbody":{data:{mass:1,drag:0,angularDrag:.05,useGravity:!0,isKinematic:!1,positionConstraints:[!1,!1,!1],rotationConstraints:[!1,!1,!1]},config:{meshComponent:!0},initComponent:function(){if(altspace.inClient&&this.placeholder){var t=function(t){this.object3d.dispatchEvent(t)}.bind(this);this.placeholder.addEventListener("native-transform-update",t)}}}},altspaceutil.behaviors.NativeComponent=function(t,e,i){this.type=t||"NativeComponent",this.nativeEvents={},this.defaults=altspaceutil.behaviors.NativeComponentDefaults[this.type],this.config=Object.assign({sendUpdates:!0,recursiveMesh:!1,recursive:!1,useCollider:!1,updateOnStaleData:!0,sharedComponent:!0,inheritParentData:!1,meshComponent:!1},this.defaults&&this.defaults.config?JSON.parse(JSON.stringify(this.defaults.config)):{},i),this.data=Object.assign(this.defaults&&this.defaults.data?JSON.parse(JSON.stringify(this.defaults.data)):{},e),this.attributes=this.defaults&&this.defaults.attributes?JSON.parse(JSON.stringify(this.defaults.attributes)):{},this.awake=function(t,e){if(this.scene=e,this.component=this.object3d=t,this.initialized=!1,altspaceutil.manageBehavior(this,this.object3d),!(this.component instanceof THREE.Mesh)){if(this.config.sharedComponent&&this.object3d.userData._sharedNativeComponent)for(var i of this.object3d.userData._sharedNativeComponent.behaviors)if(i!==this&&i.type===this.type){this.config.sharedComponent=!1;break}this.config.sharedComponent&&(this.sharedData=this.object3d.userData._sharedNativeComponent=this.object3d.userData._sharedNativeComponent||{},this.sharedData.placeholder=this.sharedData.placeholder||altspaceutil.behaviors.NativeComponentPlaceholderMesh.clone(),this.sharedData.behaviors=this.sharedData.behaviors||[],this.sharedData.behaviors.push(this),this.sharedData.placeholder.parent||this.object3d.add(this.sharedData.placeholder)),this.component=this.placeholder=this.sharedData&&this.sharedData.placeholder?this.sharedData.placeholder:altspaceutil.behaviors.NativeComponentPlaceholderMesh.clone(),this.object3d.add(this.placeholder)}this.defaults&&this.defaults.initComponent&&this.defaults.initComponent.bind(this)(),this.config.useCollider||(this.component.userData.altspace=this.component.userData.altspace||{},this.component.userData.altspace.collider=this.component.userData.altspace.collider||{},this.component.userData.altspace.collider.enabled=!1);var s=!1;if(this.config.inheritParentData&&!this.parent)for(var a=this.object3d.parent;a;){var i=a.getBehaviorByType(this.type);if(i){this.parent=i.parent||i,s=!0;break}a=a.parent}this.update(),!this.config.recursive&&!this.config.recursiveMesh||this.parent&&!s||this.object3d.traverse(function(t){t!==this.object3d&&t!==this.placeholder&&(this.config.recursive||this.config.recursiveMesh&&t instanceof THREE.Mesh)&&(t.getBehaviorByType(this.type)||t.addBehavior(Object.assign(new altspaceutil.behaviors.NativeComponent(this.type,this.data,this.config),{parent:this})))}.bind(this))},this.update=function(){if(this.placeholder&&(this.object3d.userData.altspace&&(this.placeholder.userData.altspace=this.object3d.userData.altspace),this.placeholder.visible=this.object3d.visible),this.parent&&this.config.inheritParentData&&(this.data=Object.assign({},this.parent.data)),this.parent||!this.config.recursive&&!this.config.recursiveMesh||this.object3d.traverse(function(t){t!==this.object3d&&t!==this.placeholder&&(this.config.recursive||this.config.recursiveMesh&&t instanceof THREE.Mesh)&&(t.getBehaviorByType(this.type)||t.addBehavior(Object.assign(new altspaceutil.behaviors.NativeComponent(this.type,this.data,this.config),{parent:this})))}.bind(this)),altspace.inClient){if(!this.initialized){if(!this.config.meshComponent||this.object3d instanceof THREE.Mesh)this.initialized=!0;else if(this.config.sharedComponent&&this.sharedData)for(var t of this.sharedData.behaviors)if(t.initialized){this.initialized=!0;break}this.initialized&&altspace.addNativeComponent(this.component,this.type)}if(this.config.sendUpdates)if(this.config.updateOnStaleData){var e=JSON.stringify(this.data);this.oldData!==e&&(this.defaults&&this.defaults.update?this.defaults.update.bind(this)():this.initialized&&altspace.updateNativeComponent(this.component,this.type,this.data),this.oldData=e)}else this.defaults&&this.defaults.update?this.defaults.update.bind(this)():this.initialized&&altspace.updateNativeComponent(this.component,this.type,this.data)}},this.callComponent=function(t,e){this.callComponentAction(t,e)},this.callComponentAction=function(t,e){this.initialized&&this.component&&(this.defaults&&this.defaults.callComponentAction?this.defaults.callComponentAction.bind(this)(t,e):altspace.callNativeComponentAction(this.component,this.type,t,e))},this.callComponentFunc=function(t,e){return this.initialized&&this.component?this.defaults&&this.defaults.callComponentFunc?this.defaults.callComponentFunc.bind(this)(t,e):altspace.callNativeComponentFunc(this.component,this.type,t,e):Promise.reject()},this.dispose=function(){(this.config.recursive||this.config.recursiveMesh&&!this.parent)&&this.object3d.traverse(function(t){if(t!==this.object3d&&t!==this.placeholder&&(this.config.recursive||this.config.recursiveMesh&&t instanceof THREE.Mesh)){var e=t.getBehaviorByType(this.type);e&&e.parent===this&&t.removeBehavior(e)}}.bind(this));for(var t in this.nativeEvents)this.nativeEvents.hasOwnProperty(t)&&this.nativeEvents[t].clear();if(this.initialized&&altspace.removeNativeComponent(this.component,this.type),this.config.sharedComponent&&this.sharedData){var e=this.sharedData.behaviors.indexOf(this);e>=0&&this.sharedData.behaviors.splice(e,1),this.sharedData.behaviors.length<=0&&(this.sharedData.placeholder.parent&&this.sharedData.placeholder.parent.remove(this.sharedData.placeholder),delete this.object3d.userData._sharedNativeComponent)}else this.placeholder&&this.object3d.remove(this.placeholder);this.nativeEvents={},this.initialized=!1,this.object3d=null,this.placeholder=null,this.component=null,this.scene=null,this.sharedData=null,this.oldData=null,this.parent=null},this.getAttribute=function(t){return this.attributes[t]},this.clone=function(){return new altspaceutil.behaviors.NativeComponent(this.type,this.data,this.config)}},altspaceutil.behaviors.NativeComponentSync=function(t,e){this.componentType=t||"NativeComponent",this.type=t?"sync-"+t:"NativeComponentSync",this.config=e||{},this.awake=function(t){this.object3d=t,altspaceutil.manageBehavior(this,this.object3d),this.component=this.object3d.getBehaviorByType(this.componentType),this.sync=this.config.syncRef||this.object3d.getBehaviorByType("Object3DSync"),this.dataRef=this.sync.dataRef.child(this.componentType).child("data"),this.dataRefUpdate=this.dataRef.on("value",function(t){if(!this.sync.isMine){var e=t.val();if(e)return this.component||(this.component=this.object3d.getBehaviorByType(this.componentType),this.component)?void(this.component.data=e):(this.component=new altspaceutil.behaviors.NativeComponent(this.componentType,e),void this.object3d.addBehavior(this.component))}}.bind(this)),this.intervalId=setInterval(this.update.bind(this),this.sync.autoSendRateMS)},this.update=function(){if(this.sync.isMine&&this.component){var t=JSON.stringify(this.component.data);this.oldData!==t&&(this.dataRef.set(this.component.data),this.oldData=t)}},this.dispose=function(){this.intervalId&&clearInterval(this.intervalId),this.dataRefUpdate&&this.dataRef&&this.dataRef.off("value",this.dataRefUpdate),this.object3d=null,this.component=null,this.sync=null,this.dataRef=null,this.dataRefUpdate=null,this.oldData=null},this.clone=function(){return new altspaceutil.behaviors.NativeComponentSync(this.componentType,this.config)}},altspaceutil.behaviors.OrbitControls=function(){this.type="OrbitControls",this.awake=function(t){altspace.inClient||(this.controls=new THREE.OrbitControls(t)),altspaceutil.manageBehavior(this,t)},this.update=function(t){altspace.inClient||this.controls.update()},this.dispose=function(){this.controls=null}},altspaceutil.behaviors.UserEvents=function(t){this.config=Object.assign({subscribeSelfServerEvents:!1,onRequestData:null,refreshTime:5e3,trace:!1,userIds:[]},t),this.type="UserEvents",this.awake=function(t){if(this.object3d=t,this.time=0,this.loading=!1,this.users={},this.userIds=this.config.userIds.constructor===Array?this.config.userIds:[this.config.userIds],altspaceutil.manageBehavior(this,this.object3d),this.dataRequest=new THREE.FileLoader,this.dataRequest.setWithCredentials(!0),this.userIds.length<=0){var e=this;altspace.getUser().then(function(t){e.selfUserId=t.legacyUserId?t.legacyUserId:t.userId,e.updateUserAvatarInfo(t.avatarInfo),t.addEventListener("avatarchange",e.onUpdateUserAvatarInfo.bind(e)),e.config.subscribeSelfServerEvents&&(e.userIds.push(t.legacyUserId?t.legacyUserId:t.userId),e.requestUserData())})}else this.requestUserData()},this.onUpdateUserAvatarInfo=function(t){this.updateUserAvatarInfo(t.data)},this.updateUserAvatarInfo=function(t){function e(t){if(t){var e=t.match(/^rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)$/i);if(e)return[e[1],e[2],e[3]]}return t}var i=e(t.primaryColor),s=e(t.highlightColor),a=this.selfUserId,n=this.users[a]||{userId:a};this.users[a]=n;var o=n.avatarId;n.avatarId=t.sid||null;var r,l=n.rawAvatarColors,h=n.avatarTextures,c=n.avatarId!==o;switch(n.avatarColors={},n.rawAvatarColors={},n.avatarTextures={},n.avatarId){case"rubenoid-male-01":case"rubenoid-female-01":r="Rubenoid",t.textures[0]&&(n.avatarTextures.hair=t.textures[0]),t.textures[1]&&(n.avatarTextures.skin=t.textures[1]),t.textures[2]&&(n.avatarTextures.clothing=t.textures[2]),c||(c=h.hair!==n.avatarTextures.hair||h.skin!==n.avatarTextures.skin||h.clothing!==n.avatarTextures.clothing);break;case"robothead-roundguy-01":case"robothead-propellerhead-01":r="Robothead",s&&(n.avatarColors.highlight=this.getAvatarColor(s),n.rawAvatarColors.highlight=s),c||(c=!l.highlight||JSON.stringify(l.highlight)!==JSON.stringify(n.rawAvatarColors.highlight));break;case"a-series-m01":case"pod-classic":case"s-series-f01":case"s-series-m01":case"x-series-m01":case"x-series-m02":r="Pod",i&&(n.avatarColors.primary=this.getAvatarColor(i),n.rawAvatarColors.primary=i),s&&(n.avatarColors.highlight=this.getAvatarColor(s),n.rawAvatarColors.highlight=s),c||(c=!l.primary||!l.highlight||JSON.stringify(l.primary)!==JSON.stringify(n.rawAvatarColors.primary)||JSON.stringify(l.highlight)!==JSON.stringify(n.rawAvatarColors.highlight));break;default:r="",this.config.trace&&console.log("Unknown avatar type: "+n.avatarId)}if(c){var d=this;this.object3d.dispatchEvent({type:"avatarchange",detail:{userId:n.userId,avatarId:n.avatarId,avatarClass:r,colors:n.avatarColors,rawColors:n.rawAvatarColors,textures:n.avatarTextures},bubbles:!0,target:d.object3d})}},this.update=function(t){
!this.loading&&this.userIds.length>0&&(this.time-=t,this.time<=0&&this.requestUserData())},this.onLoaded=function(t){if(this.loading){var e=JSON.parse(t),i=this;for(var s of e.users)if(s&&s.user_id){var a=s.user_id,n=this.users[a]||{userId:a};this.users[a]=n;var o=n.username;n.username=s.username||null;var r=n.displayName;n.displayName=s.display_name||null;var l=n.online;n.online=s.online||!1;var h=s.user_avatar.config.avatar,c=n.avatarId;n.avatarId=h.avatar_sid||null;var d,u=n.rawAvatarColors,p=n.avatarTextures,g=n.avatarId!==c;switch(n.avatarColors={},n.rawAvatarColors={},n.avatarTextures={},n.avatarId){case"rubenoid-male-01":case"rubenoid-female-01":d="Rubenoid";var v="rubenoid-male-01"===n.avatarId?"rubenoid-male-texture-":"rubenoid-female-texture-";h[v+"1"][0]&&(n.avatarTextures.hair=h[v+"1"][0]),h[v+"2"][0]&&(n.avatarTextures.skin=h[v+"2"][0]),h[v+"3"][0]&&(n.avatarTextures.clothing=h[v+"3"][0]),g||(g=p.hair!==n.avatarTextures.hair||p.skin!==n.avatarTextures.skin||p.clothing!==n.avatarTextures.clothing);break;case"robothead-roundguy-01":case"robothead-propellerhead-01":d="Robothead",h["robothead-highlight-color"]&&(n.avatarColors.highlight=this.getAvatarColor(h["robothead-highlight-color"]),n.rawAvatarColors.highlight=h["robothead-highlight-color"]),g||(g=!u.highlight||JSON.stringify(u.highlight)!==JSON.stringify(n.rawAvatarColors.highlight));break;case"a-series-m01":case"pod-classic":case"s-series-f01":case"s-series-m01":case"x-series-m01":case"x-series-m02":d="Pod",h["primary-color"]&&(n.avatarColors.primary=this.getAvatarColor(h["primary-color"]),n.rawAvatarColors.primary=h["primary-color"]),h["highlight-color"]&&(n.avatarColors.highlight=this.getAvatarColor(h["highlight-color"]),n.rawAvatarColors.highlight=h["highlight-color"]),g||(g=!u.primary||!u.highlight||JSON.stringify(u.primary)!==JSON.stringify(n.rawAvatarColors.primary)||JSON.stringify(u.highlight)!==JSON.stringify(n.rawAvatarColors.highlight));break;default:d="",this.config.trace&&console.log("Unknown avatar type: "+n.avatarId)}n.username===o&&n.displayName===r||this.object3d.dispatchEvent({type:"userchange",detail:{userId:n.userId,username:n.username,displayName:n.displayName},bubbles:!0,target:i.object3d}),g&&this.object3d.dispatchEvent({type:"avatarchange",detail:{userId:n.userId,avatarId:n.avatarId,avatarClass:d,colors:n.avatarColors,rawColors:n.rawAvatarColors,textures:n.avatarTextures},bubbles:!0,target:i.object3d}),n.online!==l&&this.object3d.dispatchEvent({type:"avatarstatus",detail:{userId:n.userId,displayName:n.displayName,online:!!n.online},bubbles:!0,target:i.object3d})}this.loading=!1}},this.onError=function(t){if(this.loading){if(this.config.trace){var e=t.target.responseURL||"";console.log("Error loading avatar data "+e)}this.loading=!1}},this.subscribeUser=function(t){var e=this.userIds.indexOf(t);e===-1&&this.userIds.push(t)},this.unsubscribeUser=function(t){var e=this.userIds.indexOf(t);e>=0&&this.userIds.splice(e,1)},this.requestUserData=function(){if(!(!this.dataRequest||this.loading||this.userIds.length<=0)){var t=[];for(var e of this.userIds)this.config.onRequestData&&!this.config.onRequestData.call(this,e,this.object3d)||t.push(e);t.length>0&&(this.dataRequest.load("https://account.altvr.com/api/v1/users/"+t.join(),this.onLoaded.bind(this),void 0,this.onError.bind(this)),this.time=this.config.refreshTime,this.loading=!0)}},this.getAvatarColor=function(t){function e(t,e,i){var s=Math.max(t,e,i);return s>255&&(t=Math.floor(t/s*255),e=Math.floor(e/s*255),i=Math.floor(i/s*255)),new THREE.Color(t/255,e/255,i/255)}function i(t){var e={black:{r:.1,g:.1,b:.1},darkgrey:{r:.3,g:.3,b:.3},grey:{r:.75,g:.75,b:.75},white:{r:1,g:1,b:1}};return t=t in e?t:"white",new THREE.Color(e[t].r,e[t].g,e[t].b)}if("string"==typeof t){var s=t.match(/^rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)$/i);return s?e(s[1],s[2],s[3]):i(t)}if(t.constructor===Array&&1===t.length&&"string"==typeof t[0]){var s=t[0].match(/^rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)$/i);return s?e(s[1],s[2],s[3]):i(t[0])}return e(t[0],t[1],t[2])},this.dispose=function(){this.dataRequest=null,this.object3d=null,this.time=0,this.loading=!1,this.users={}},this.clone=function(){return new altspaceutil.behaviors.UserEvents(this.config)}},altspaceutil.behaviors.PreloadNativeSounds=function(t,e){this.type="PreloadSoundEffects",this.sounddata=t,this.config=Object.assign({timeout:1e4,dispose:!0},e||{}),this.awake=function(t){this.object3d=t,this.elapsedTime=0,this.preloadedCount=0,this.isTimedOut=!1,this.sounds=[],altspaceutil.manageBehavior(this,this.object3d),this.soundLoadedEventHandler=function(t){if(this.preloadedCount>0&&--this.preloadedCount,!this.isTimedOut&&this.preloadedCount<=0){var e=this;this.object3d.dispatchEvent({type:"n-sound-preloaded",behavior:e,sounds:e.sounds,timeout:!1,bubbles:!0}),this.object3d.removeBehavior(this)}}.bind(this);for(var e of this.sounddata){++this.preloadedCount;var i=new THREE.Object3D;i.addBehavior(new altspaceutil.behaviors.NativeComponent("n-sound","string"==typeof e||e instanceof String?{src:e}:e)),i.addEventListener("n-sound-loaded",this.soundLoadedEventHandler),this.object3d.add(i),this.sounds.push(i)}},this.update=function(t){if(this.elapsedTime+=t,this.preloadedCount>0&&!this.isTimedOut&&this.config.timeout>0&&this.elapsedTime>=this.config.timeout&&this.object3d){this.isTimedOut=!0;var e=this;this.object3d.dispatchEvent({type:"n-sound-preloaded",behavior:e,sounds:e.sounds,timeout:!0,bubbles:!0}),this.object3d.removeBehavior(this)}},this.dispose=function(){for(var t of this.sounds)t.removeEventListener("n-sound-loaded",this.soundLoadedEventHandler),this.config.dispose&&t.parent&&t.parent.remove(t);this.soundLoadedEventHandler=null,this.sounds=null,this.object3d=null,this.elapsedTime=0,this.preloadedCount=0},this.clone=function(){return new altspaceutil.behaviors.PreloadNativeSounds(this.sounddata,this.config)}},altspaceutil.behaviors.TransformControls=function(t){this.type="TransformControls",this.config=Object.assign({controlType:"none",showButtons:!1,followTarget:!0,target:null,scale:1,allowNegativeScale:!1,disableColliders:!0,disableChildColliders:!0},t),this.config.positionAxisLock=Object.assign({x:!0,y:!0,z:!0},this.config.positionAxisLock),this.config.rotateAxisLock=Object.assign({x:!0,y:!0,z:!0},this.config.rotateAxisLock),this.config.scaleAxisLock=Object.assign({x:!0,y:!0,z:!0},this.config.scaleAxisLock),this.awake=function(t,e){this.object3d=t,this.scene=e,this.target=this.config.target||this.object3d,altspaceutil.behaviors.TransformControls.Materials||(altspaceutil.behaviors.TransformControls.Materials={red:new THREE.MeshBasicMaterial({color:16711680}),green:new THREE.MeshBasicMaterial({color:65280}),blue:new THREE.MeshBasicMaterial({color:255}),yellow:new THREE.MeshBasicMaterial({color:16776960}),orange:new THREE.MeshBasicMaterial({color:16763904}),hidden:new THREE.MeshBasicMaterial({side:THREE.DoubleSide,visible:!1}),"red-transclucent":new THREE.MeshBasicMaterial({color:16711680,transparent:!0,opacity:.2}),"green-transclucent":new THREE.MeshBasicMaterial({color:65280,transparent:!0,opacity:.2}),"blue-transclucent":new THREE.MeshBasicMaterial({color:255,transparent:!0,opacity:.2})}),altspaceutil.behaviors.TransformControls.Geometries||(altspaceutil.behaviors.TransformControls.Geometries={button:new THREE.BoxBufferGeometry(.2,.2,.2),intersector:new THREE.PlaneBufferGeometry(1e5,1e5)}),altspaceutil.manageBehavior(this,this.object3d),this.objectState={},this.controls={none:null,position:new THREE.Group,rotate:new THREE.Group,scale:new THREE.Group},this.selectedControlType=this.config.controlType,this.selectedControl=null,this.controlTypeButtons=null,this.scene.addEventListener("cursormove",function(t){if(!this.selectedControl)return void(this.hoveredAxis&&(this.hoveredAxis.traverse(function(t){t instanceof THREE.Mesh&&t.userData.material&&(t.material=t.userData.material,delete t.userData.material,t.geometry.uvsNeedUpdate=!0)}.bind(this)),this.hoveredAxis=null));this.raycaster.set(t.ray.origin,t.ray.direction);var e=this.raycaster.intersectObject(this.selectedControl,!0)[0];!this.hoveredAxis||e&&this.hoveredAxis===e.object||(this.dragAxis||this.hoveredAxis.traverse(function(t){t instanceof THREE.Mesh&&t.userData.material&&(t.material=t.userData.material,delete t.userData.material,t.geometry.uvsNeedUpdate=!0)}.bind(this)),this.hoveredAxis=null),e&&(this.hoveredAxis=e.object,this.dragAxis||this.hoveredAxis.traverse(function(t){t instanceof THREE.Mesh&&!t.userData.material&&t.material.visible&&(t.userData.material=t.material,t.material=altspaceutil.behaviors.TransformControls.Materials.orange,t.geometry.uvsNeedUpdate=!0)}.bind(this)))}.bind(this));var i=function(t,e,i,s){return Object.assign(s?new THREE.Mesh(new THREE.BoxBufferGeometry(i.width,i.height,i.depth),altspaceutil.behaviors.TransformControls.Materials[e]):new THREE.Group,{name:t})}.bind(this),s=function(t,e,i,s,a,n){if(!n)return Object.assign(new THREE.Object3D,{name:t});if(altspaceutil.behaviors.TransformControls.Geometries["axis-position-"+t]){var o=Object.assign(new THREE.Mesh(altspaceutil.behaviors.TransformControls.Geometries["axis-position-"+t].clone(),altspaceutil.behaviors.TransformControls.Materials[e]),{name:t});return o.position.set(s.x,s.y,s.z),o.rotation.set(a.x,a.y,a.z),o}var o=Object.assign(new THREE.Mesh(new THREE.BoxGeometry(i.width,i.height,i.depth),altspaceutil.behaviors.TransformControls.Materials[e]),{name:t});o.position.set(s.x,s.y,s.z),o.rotation.set(a.x,a.y,a.z);var r=new THREE.Object3D;r.position.set(i.width/2,0,0),r.rotation.set(0,0,-Math.PI/2),r.updateMatrix();var l=new THREE.CylinderGeometry(0,2*i.depth,4*i.depth,4,1,!1,Math.PI/4);return l.applyMatrix(r.matrix),o.geometry.merge(l),o.geometry=(new THREE.BufferGeometry).fromGeometry(o.geometry),altspaceutil.behaviors.TransformControls.Geometries["axis-position-"+t]=o.geometry,o}.bind(this),a=function(t,e,i,s,a){if(!a)return Object.assign(new THREE.Object3D,{name:t});altspaceutil.behaviors.TransformControls.Geometries["axis-rotate-"+t]||(altspaceutil.behaviors.TransformControls.Geometries["axis-rotate-"+t]=new THREE.RingBufferGeometry(.8*i.radius,1.5*i.radius,10,1));var n=Object.assign(new THREE.Mesh(altspaceutil.behaviors.TransformControls.Geometries["axis-rotate-"+t],altspaceutil.behaviors.TransformControls.Materials.hidden),{name:t});n.rotation.set(s.x,s.y,s.z);var o=Object.assign(new THREE.Mesh(new THREE.TorusBufferGeometry(i.radius,i.tube,i.radialSegments,i.tubularSegments),altspaceutil.behaviors.TransformControls.Materials[e]),{name:t});return n.add(o),n}.bind(this),n=function(t,e,i,s,a,n){if(!n)return Object.assign(new THREE.Object3D,{name:t});if(altspaceutil.behaviors.TransformControls.Geometries["axis-scale-"+t]){var o=Object.assign(new THREE.Mesh(altspaceutil.behaviors.TransformControls.Geometries["axis-scale-"+t].clone(),altspaceutil.behaviors.TransformControls.Materials[e]),{name:t});return o.position.set(s.x,s.y,s.z),o.rotation.set(a.x,a.y,a.z),o}var o=Object.assign(new THREE.Mesh(new THREE.BoxGeometry(i.width,i.height,i.depth),altspaceutil.behaviors.TransformControls.Materials[e]),{name:t});o.position.set(s.x,s.y,s.z),o.rotation.set(a.x,a.y,a.z);var r=new THREE.Object3D;r.position.set(i.width/2,0,0),r.rotation.set(0,0,-Math.PI/2),r.updateMatrix();var l=new THREE.BoxGeometry(2*i.depth,2*i.depth,2*i.depth);return l.applyMatrix(r.matrix),o.geometry.merge(l),o.geometry=(new THREE.BufferGeometry).fromGeometry(o.geometry),altspaceutil.behaviors.TransformControls.Geometries["axis-scale-"+t]=o.geometry,o}.bind(this);if(this.controls.position.name="position",this.controls.position.add(i("xyz","yellow",{width:.15,height:.15,depth:.15},this.config.positionAxisLock.x||this.config.positionAxisLock.y||this.config.positionAxisLock.z).add(s("x","red",{width:1,height:.05,depth:.05},{x:.5,y:0,z:0},{x:0,y:0,z:0},this.config.positionAxisLock.x),s("y","green",{width:1,height:.05,depth:.05},{x:0,y:.5,z:0},{x:0,y:0,z:Math.PI/2},this.config.positionAxisLock.y),s("z","blue",{width:1,height:.05,depth:.05},{x:0,y:0,z:.5},{x:Math.PI/2,y:0,z:Math.PI/2},this.config.positionAxisLock.z))),this.controls.rotate.name="rotate",this.controls.rotate.add(i("xyz","yellow",{width:.05,height:.05,depth:.05},this.config.rotateAxisLock.x||this.config.rotateAxisLock.y||this.config.rotateAxisLock.z).add(a("x","red",{radius:.7,tube:.03,radialSegments:8,tubularSegments:28},{x:0,y:Math.PI/2,z:0},this.config.rotateAxisLock.x),a("y","green",{radius:.7,tube:.03,radialSegments:8,tubularSegments:28},{x:Math.PI/2,y:0,z:0},this.config.rotateAxisLock.y),a("z","blue",{radius:.7,tube:.03,radialSegments:8,tubularSegments:28},{x:0,y:0,z:0},this.config.rotateAxisLock.z))),this.controls.scale.name="scale",this.controls.scale.add(i("xyz","yellow",{width:.15,height:.15,depth:.15},this.config.scaleAxisLock.x||this.config.scaleAxisLock.y||this.config.scaleAxisLock.z).add(n("x","red",{width:1,height:.05,depth:.05},{x:.5,y:0,z:0},{x:0,y:0,z:0},this.config.scaleAxisLock.x),n("y","green",{width:1,height:.05,depth:.05},{x:0,y:.5,z:0},{x:0,y:0,z:Math.PI/2},this.config.scaleAxisLock.y),n("z","blue",{width:1,height:.05,depth:.05},{x:0,y:0,z:.5},{x:Math.PI/2,y:0,z:Math.PI/2},this.config.scaleAxisLock.z))),this.onDragBegin=function(t){if(this.dragAxis=null,this.selectedControl){this.raycaster.set(t.ray.origin,t.ray.direction);var e=this.raycaster.intersectObject(this.selectedControl,!0)[0];if(e){this.dragAxis=e.object.name,this.hoveredAxis&&this.hoveredAxis.traverse(function(t){t instanceof THREE.Mesh&&t.userData.material&&(t.material=t.userData.material,delete t.userData.material,t.geometry.uvsNeedUpdate=!0)}.bind(this));var i=this.selectedControl.getObjectByName(this.dragAxis);i&&i.traverse(function(t){t instanceof THREE.Mesh&&!t.userData.material&&t.material.visible&&(t.userData.material=t.material,t.material=altspaceutil.behaviors.TransformControls.Materials.orange,t.geometry.uvsNeedUpdate=!0)}.bind(this)),this.scene.updateMatrixWorld(),this.dragPointBegin=e.point.clone(),this.controlbase.removeEventListener("cursordown",this.onDragBegin),this.scene.addEventListener("cursorup",this.onDragEnd),this.scene.addEventListener("cursormove",this.onDragMove),this.intersector.quaternion.copy(this.selectedControl.getObjectByName(this.dragAxis).quaternion),"xyz"===this.dragAxis&&(this.originIntersectors.traverse(function(t){t instanceof THREE.Mesh&&(t.visible=!0)}),e=this.raycaster.intersectObjects([this.originIntersectors.children[0],this.originIntersectors.children[1],this.originIntersectors.children[2]],!0)[0],this.originIntersector=e&&e.object?e.object:this.intersector,e&&(this.dragPointBegin=e.point.clone()),this.originIntersectors.traverse(function(t){t instanceof THREE.Mesh&&(t.visible=!1)})),this.dispatchDragBeginEvent()}}}.bind(this),this.onDragMove=function(t){if(!this.selectedControl)return this.scene.removeEventListener("cursorup",this.onDragEnd),this.scene.removeEventListener("cursormove",this.onDragMove),this.controlbase.addEventListener("cursordown",this.onDragBegin),void(this.dragAxis=null);var e;if(this.raycaster.set(t.ray.origin,t.ray.direction),"xyz"===this.dragAxis?(this.originIntersector.visible=!0,e=this.raycaster.intersectObject(this.originIntersector,!0)[0],this.originIntersector.visible=!1):(this.intersector.quaternion.copy(this.selectedControl.getObjectByName(this.dragAxis).quaternion),this.intersector.visible=!0,e=this.raycaster.intersectObject(this.intersector,!0)[0],this.intersector.visible=!1),e){var i=this.dragPointBegin.clone().sub(this.object3d.position),s=e.point.clone().sub(this.object3d.position),a=e.point.clone().sub(this.dragPointBegin);this.dragPointBegin=e.point.clone();var n=new THREE.Vector3;if("position"===this.selectedControlType)switch(this.dragAxis){case"x":case"y":case"z":this.config.positionAxisLock[this.dragAxis]&&(n[this.dragAxis]+=a[this.dragAxis],this.target.position.add(n));break;case"xyz":(this.config.positionAxisLock.x||this.config.positionAxisLock.y||this.config.positionAxisLock.z)&&("x"===this.originIntersector.name?n.set(this.config.positionAxisLock.x?a.x:0,this.config.positionAxisLock.y?a.y:0,0):"y"===this.originIntersector.name?n.set(0,this.config.positionAxisLock.y?a.y:0,this.config.positionAxisLock.z?a.z:0):"z"===this.originIntersector.name?n.set(this.config.positionAxisLock.x?a.x:0,0,this.config.positionAxisLock.z?a.z:0):n.set(this.config.positionAxisLock.x?a.x:0,this.config.positionAxisLock.y?a.y:0,this.config.positionAxisLock.z?a.z:0),this.target.position.add(n))}else if("scale"===this.selectedControlType)switch(this.dragAxis){case"x":case"y":case"z":this.config.scaleAxisLock[this.dragAxis]&&(n[this.dragAxis]+=a[this.dragAxis],this.target.scale.add(n),(void 0===this.target.scale[this.dragAxis]||isNaN(this.target.scale[this.dragAxis])||!this.config.allowNegativeScale&&this.target.scale[this.dragAxis]<0)&&(this.target.scale[this.dragAxis]=Number.EPSILON));break;default:if(this.config.scaleAxisLock.x||this.config.scaleAxisLock.y||this.config.scaleAxisLock.z){var o=a.x;Math.abs(a.y)>Math.abs(o)&&(o=a.y),Math.abs(a.z)>Math.abs(o)&&(o=a.z),n.set(this.config.scaleAxisLock.x?o:0,this.config.scaleAxisLock.y?o:0,this.config.scaleAxisLock.z?o:0),this.target.scale.add(n),(void 0===this.target.scale.x||isNaN(this.target.scale.x)||!this.config.allowNegativeScale&&this.target.scale.x<0)&&(this.target.scale.x=Number.EPSILON),(void 0===this.target.scale.y||isNaN(this.target.scale.y)||!this.config.allowNegativeScale&&this.target.scale.y<0)&&(this.target.scale.y=Number.EPSILON),(void 0===this.target.scale.z||isNaN(this.target.scale.z)||!this.config.allowNegativeScale&&this.target.scale.z<0)&&(this.target.scale.z=Number.EPSILON)}}else if("rotate"===this.selectedControlType&&this.config.rotateAxisLock[this.dragAxis]){switch(this.dragAxis){case"x":var r=Math.atan2(s.z,s.y)-Math.atan2(i.z,i.y);n[this.dragAxis]+=r;break;case"y":var r=Math.atan2(s.x,s.z)-Math.atan2(i.x,i.z);n[this.dragAxis]+=r;break;case"z":var r=Math.atan2(s.y,s.x)-Math.atan2(i.y,i.x);n[this.dragAxis]+=r}this.target.rotation[this.dragAxis]+=n[this.dragAxis]}this.updateTransform(),this.dispatchDragMoveEvent(n)}}.bind(this),this.onDragEnd=function(t){this.scene.removeEventListener("cursorup",this.onDragEnd),this.scene.removeEventListener("cursormove",this.onDragMove),this.controlbase.addEventListener("cursordown",this.onDragBegin);var e=this.dragAxis;if(this.dragAxis=null,this.selectedControl&&e){var i=this.selectedControl.getObjectByName(e);i&&i.traverse(function(t){t instanceof THREE.Mesh&&t.userData.material&&(t.material=t.userData.material,delete t.userData.material,t.geometry.uvsNeedUpdate=!0)}.bind(this)),this.hoveredAxis&&this.hoveredAxis.traverse(function(t){t instanceof THREE.Mesh&&!t.userData.material&&t.material.visible&&(t.userData.material=t.material,t.material=altspaceutil.behaviors.TransformControls.Materials.orange,t.geometry.uvsNeedUpdate=!0)}.bind(this))}if(this.selectedControl){var s;if(this.raycaster.set(t.ray.origin,t.ray.direction),"xyz"===e?(this.originIntersector.visible=!0,s=this.raycaster.intersectObject(this.originIntersector,!0)[0],this.originIntersector.visible=!1):(this.intersector.quaternion.copy(this.selectedControl.getObjectByName(e).quaternion),this.intersector.visible=!0,s=this.raycaster.intersectObject(this.intersector,!0)[0],this.intersector.visible=!1),s){var a=this.dragPointBegin.clone().sub(this.object3d.position),n=s.point.clone().sub(this.object3d.position),o=s.point.clone().sub(this.dragPointBegin);this.dragPointBegin=s.point.clone();var r=new THREE.Vector3;if("position"===this.selectedControlType)switch(e){case"x":case"y":case"z":this.config.positionAxisLock[e]&&(r[e]+=o[e],this.target.position.add(r));break;case"xyz":(this.config.positionAxisLock.x||this.config.positionAxisLock.y||this.config.positionAxisLock.z)&&("x"===this.originIntersector.name?r.set(this.config.positionAxisLock.x?o.x:0,this.config.positionAxisLock.y?o.y:0,0):"y"===this.originIntersector.name?r.set(0,this.config.positionAxisLock.y?o.y:0,this.config.positionAxisLock.z?o.z:0):"z"===this.originIntersector.name?r.set(this.config.positionAxisLock.x?o.x:0,0,this.config.positionAxisLock.z?o.z:0):r.set(this.config.positionAxisLock.x?o.x:0,this.config.positionAxisLock.y?o.y:0,this.config.positionAxisLock.z?o.z:0),this.target.position.add(r))}else if("scale"===this.selectedControlType)switch(e){case"x":case"y":case"z":this.config.scaleAxisLock[e]&&(r[e]+=o[e],this.target.scale.add(r),(void 0===this.target.scale[e]||isNaN(this.target.scale[e])||!this.config.allowNegativeScale&&this.target.scale[e]<0)&&(this.target.scale[e]=Number.EPSILON));break;default:if(this.config.scaleAxisLock.x||this.config.scaleAxisLock.y||this.config.scaleAxisLock.z){var l=o.x;Math.abs(o.y)>Math.abs(l)&&(l=o.y),Math.abs(o.z)>Math.abs(l)&&(l=o.z),r.set(this.config.scaleAxisLock.x?l:0,this.config.scaleAxisLock.y?l:0,this.config.scaleAxisLock.z?l:0),this.target.scale.add(r),(void 0===this.target.scale.x||isNaN(this.target.scale.x)||!this.config.allowNegativeScale&&this.target.scale.x<0)&&(this.target.scale.x=Number.EPSILON),(void 0===this.target.scale.y||isNaN(this.target.scale.y)||!this.config.allowNegativeScale&&this.target.scale.y<0)&&(this.target.scale.y=Number.EPSILON),(void 0===this.target.scale.z||isNaN(this.target.scale.z)||!this.config.allowNegativeScale&&this.target.scale.z<0)&&(this.target.scale.z=Number.EPSILON)}}else if("rotate"===this.selectedControlType&&this.config.rotateAxisLock[e]){switch(e){case"x":var h=Math.atan2(n.z,n.y)-Math.atan2(a.z,a.y);r[e]+=h;break;case"y":var h=Math.atan2(n.x,n.z)-Math.atan2(a.x,a.z);r[e]+=h;break;case"z":var h=Math.atan2(n.y,n.x)-Math.atan2(a.y,a.x);r[e]+=h}this.target.rotation[e]+=r[e]}this.updateTransform(),this.dispatchDragMoveEvent(r),this.dispatchDragEndEvent(e)}}}.bind(this),this.config.showButtons){var o=function(t){this.buttonDownControlType=t.target.name}.bind(this),r=function(t){t.target.name===this.buttonDownControlType&&this.setActiveControl(this.buttonDownControlType===this.selectedControlType?"none":this.buttonDownControlType)}.bind(this);this.controlTypeButtons=new THREE.Group,this.controlTypeButtons.position.set(.5,1,0);var l=Object.assign(new THREE.Mesh(altspaceutil.behaviors.TransformControls.Geometries.button,altspaceutil.behaviors.TransformControls.Materials["red-transclucent"]),{name:"position"}),h=this.controls.position.clone();h.position.set(-.025,-.025,-.025),h.scale.multiplyScalar(.1),l.add(h),l.addEventListener("cursordown",o),l.addEventListener("cursorup",r);var c=Object.assign(new THREE.Mesh(altspaceutil.behaviors.TransformControls.Geometries.button,altspaceutil.behaviors.TransformControls.Materials["green-transclucent"]),{name:"rotate"}),d=this.controls.rotate.clone();d.scale.multiplyScalar(.1),c.add(d),c.position.set(.25,0,0),c.addEventListener("cursordown",o),c.addEventListener("cursorup",r);var u=Object.assign(new THREE.Mesh(altspaceutil.behaviors.TransformControls.Geometries.button,altspaceutil.behaviors.TransformControls.Materials["blue-transclucent"]),{name:"scale"}),p=this.controls.scale.clone();p.position.set(-.025,-.025,-.025),p.scale.multiplyScalar(.1),u.add(p),u.position.set(.5,0,0),u.addEventListener("cursordown",o),u.addEventListener("cursorup",r),this.controlTypeButtons.add(l,c,u)}this.raycaster=new THREE.Raycaster,this.intersector=Object.assign(new THREE.Mesh(altspaceutil.behaviors.TransformControls.Geometries.intersector,altspaceutil.behaviors.TransformControls.Materials.hidden),{visible:!1}),this.originIntersectors=new THREE.Group,this.originIntersectors.add(Object.assign(new THREE.Mesh(altspaceutil.behaviors.TransformControls.Geometries.intersector,altspaceutil.behaviors.TransformControls.Materials.hidden),{name:"x",visible:!1}),Object.assign(new THREE.Mesh(altspaceutil.behaviors.TransformControls.Geometries.intersector,altspaceutil.behaviors.TransformControls.Materials.hidden),{name:"y",visible:!1}),Object.assign(new THREE.Mesh(altspaceutil.behaviors.TransformControls.Geometries.intersector,altspaceutil.behaviors.TransformControls.Materials.hidden),{name:"z",visible:!1})),this.originIntersectors.children[1].rotation.y=Math.PI/2,this.originIntersectors.children[2].rotation.x=Math.PI/2,this.controlbase=new THREE.Group,this.controlbase.add(this.controls.position,this.controls.rotate,this.controls.scale,this.intersector,this.originIntersectors),this.controlbase.traverse(function(t){t.userData.isTransformControl=!0,t.visible=!1}),this.controlbase.addEventListener("cursordown",this.onDragBegin),this.scene.add(this.controlbase),this.controlbase.scale.setScalar(this.config.scale),this.controlTypeButtons&&this.controlbase.add(this.controlTypeButtons),this.setActiveControl(this.selectedControlType)},this.dispatchDragMoveEvent=function(t){if(0!==t.x||0!==t.y||0!==t.z){var e=this;this.object3d.dispatchEvent({type:"transform-controls-dragmove",detail:{behavior:e,parent:e.object3d,transformTarget:e.target,transformType:e.selectedControlType,transformAxis:e.dragAxis,transformDelta:t},bubbles:!0,target:e.object3d})}},this.dispatchDragBeginEvent=function(){var t=this;this.object3d.dispatchEvent({type:"transform-controls-dragbegin",detail:{behavior:t,parent:t.object3d,transformTarget:t.target,transformType:t.selectedControlType,transformAxis:t.dragAxis},bubbles:!0,target:t.object3d})},this.dispatchDragEndEvent=function(t){var e=this;this.object3d.dispatchEvent({type:"transform-controls-dragend",detail:{behavior:e,parent:e.object3d,transformTarget:e.target,transformType:e.selectedControlType,transformAxis:t},bubbles:!0,target:e.object3d})},this.updateTransform=function(){this.scene.updateMatrixWorld(),this.controlbase.position.copy((this.config.followTarget?this.target:this.object3d).getWorldPosition(new THREE.Vector3))},this.update=function(){this.updateTransform(),this.target&&(this.config.disableColliders||this.config.disableChildColliders)&&this.target.traverse(function(t){t===this.target&&!this.config.disableColliders||t!==this.target&&!this.config.disableChildColliders||t.userData.isTransformControl||t.userData.altspace&&t.userData.altspace.collider&&!t.userData.altspace.collider.enabled||(this.objectState[t.uuid]=Object.assign(this.objectState[t.uuid]||{},{collider:{enabled:!0}}),t.userData.altspace={collider:{enabled:!1}})}.bind(this))},this.dispose=function(){this.setActiveControl("none"),this.intersector&&this.intersector.parent&&this.intersector.parent.remove(this.intersector),this.controlTypeButtons&&this.controlTypeButtons.parent&&this.controlTypeButtons.parent.remove(this.controlTypeButtons),this.target&&(this.config.disableColliders||this.config.disableChildColliders)&&this.target.traverse(function(t){t===this.target&&!this.config.disableColliders||t!==this.target&&!this.config.disableChildColliders||!t.userData.isTransformControl&&this.objectState[t.uuid]&&(t.userData.altspace=Object.assign(t.userData.altspace||{},{collider:this.objectState[t.uuid].collider}),delete this.objectState[t.uuid])}.bind(this)),this.object3d=null,this.target=null,this.scene=null,this.objectState=null,this.controls=null,this.selectedControlType=null,this.selectedControl=null,this.controlbase=null,this.controlTypeButtons=null,this.buttonDownControlType=null,this.intersector=null,this.raycaster=null,this.originIntersectors=null,this.originIntersector=null,this.dragPointBegin=null,this.dragAxis=null,this.hoveredAxis=null,this.onDragBegin=null,this.onDragEnd=null,this.onDragMove=null},this.setActiveControl=function(t){if(!this.controls&&["none","position","rotate","scale"].indexOf(t)>=0)return void(this.config.controlType=t);if(this.controls&&this.object3d&&this.target&&this.controls.hasOwnProperty(t)){if(this.selectedControl){if(t===this.selectedControl.name)return;this.selectedControl.traverse(function(t){t.visible=!1})}else if("none"===t)return;this.selectedControl=this.controls[t],this.selectedControlType=this.selectedControl?this.selectedControl.name:"none",this.selectedControl&&this.selectedControl.traverse(function(t){t.visible=!0}),this.update()}},this.getActiveControl=function(){return this.selectedControlType},this.setTarget=function(t){this.target&&(this.config.disableColliders||this.config.disableChildColliders)&&this.target.traverse(function(t){t===this.target&&!this.config.disableColliders||t!==this.target&&!this.config.disableChildColliders||!t.userData.isTransformControl&&this.objectState[t.uuid]&&(t.userData.altspace=Object.assign(t.userData.altspace||{},{collider:this.objectState[t.uuid].collider}),delete this.objectState[t.uuid])}.bind(this)),this.target=this.config.target=t,this.target&&(this.config.disableColliders||this.config.disableChildColliders)&&this.target.traverse(function(t){t===this.target&&!this.config.disableColliders||t!==this.target&&!this.config.disableChildColliders||t.userData.isTransformControl||t.userData.altspace&&t.userData.altspace.collider&&!t.userData.altspace.collider.enabled||(this.objectState[t.uuid]=Object.assign(this.objectState[t.uuid]||{},{collider:{enabled:!0}}),t.userData.altspace={collider:{enabled:!1}})}.bind(this))},this.getTarget=function(){return this.target}},window.AFRAME&&(AFRAME.components["altspace-transform-controls"]&&delete AFRAME.components["altspace-transform-controls"],AFRAME.registerComponent("altspace-transform-controls",{schema:{controlType:{type:"string",default:"none"},showButtons:{type:"boolean",default:!1},followTarget:{type:"boolean",default:!0},target:{type:"selector"},scale:{type:"number",default:1},allowNegativeScale:{type:"boolean",default:!1},syncEvents:{type:"boolean",default:!0},positionAxisLock:{default:"xyz",parse:function(t){return{x:t.indexOf("x")!==-1,y:t.indexOf("y")!==-1,z:t.indexOf("z")!==-1}}},rotateAxisLock:{default:"xyz",parse:function(t){return{x:t.indexOf("x")!==-1,y:t.indexOf("y")!==-1,z:t.indexOf("z")!==-1}}},scaleAxisLock:{default:"xyz",parse:function(t){return{x:t.indexOf("x")!==-1,y:t.indexOf("y")!==-1,z:t.indexOf("z")!==-1}}},disableColliders:{type:"boolean",default:!0},disableChildColliders:{type:"boolean",default:!0}},init:function(){if(this.behavior=new altspaceutil.behaviors.TransformControls({controlType:this.data.controlType,showButtons:this.data.showButtons,followTarget:this.data.followTarget,target:this.data.target?this.data.target.object3D:null,scale:this.data.scale,allowNegativeScale:this.data.allowNegativeScale,positionAxisLock:this.data.positionAxisLock,rotateAxisLock:this.data.rotateAxisLock,scaleAxisLock:this.data.scaleAxisLock,disableColliders:this.data.disableColliders,disableChildColliders:this.data.disableChildColliders}),this.el.object3D.addBehavior(this.behavior),this.data.syncEvents){var t=function(t){var e=this.el.object3D.getBehaviorByType("TransformControls").getTarget().el;e&&e.components.sync&&e.components.sync.isConnected&&(e.components.sync.takeOwnership(),e.setAttribute("position",e.object3D.position),e.setAttribute("rotation",{x:THREE.Math.radToDeg(e.object3D.rotation.x),y:THREE.Math.radToDeg(e.object3D.rotation.y),z:THREE.Math.radToDeg(e.object3D.rotation.z)}),e.setAttribute("scale",e.object3D.scale))}.bind(this);this.el.object3D.addEventListener("transform-controls-dragbegin",t),this.el.object3D.addEventListener("transform-controls-dragmove",t),this.el.object3D.addEventListener("transform-controls-dragend",t)}},remove:function(){this.behavior&&this.el.object3D.removeBehavior(this.behavior)}})),altspaceutil.behaviors.HoverMaterialColor=function(t){t=t||{},this.type="HoverMaterialColor",this.awake=function(e){this.color=t.color||new THREE.Color("yellow"),this.beginDuration=t.beginDuration||75,this.endDuration=t.endDuration||75,this.revertOnDispose=void 0===t.revertOnDispose||t.revertOnDispose,this.hoverChildren=void 0===t.hoverChildren||t.hoverChildren,this.object3d=e,this.eventListener=t.eventListener||this.object3d,this.material=t.material||this.object3d.material,this.originalColor=this.material.color.clone(),this.srcColor=this.color,this.destColor=this.originalColor,this.srcDuration=this.beginDuration,this.destDuration=this.endDuration,this.duration=this.destDuration,
this.progress=1,this.elapsedTime=this.duration,this.eventListener.addEventListener("cursorenter",this.onHoverStateChange.bind(this)),this.eventListener.addEventListener("cursorleave",this.onHoverStateChange.bind(this))},this.update=function(t){this.progress<1&&(this.elapsedTime+=t,this.elapsedTime=THREE.Math.clamp(this.elapsedTime,0,this.duration),this.progress=THREE.Math.clamp(this.elapsedTime/this.duration,0,1),this.material.color.copy(this.srcColor).lerp(this.destColor,this.progress))},this.dispose=function(){this.eventListener.removeEventListener("cursorenter",this.onHoverStateChange.bind(this)),this.eventListener.removeEventListener("cursorleave",this.onHoverStateChange.bind(this)),this.revertOnDispose&&this.material.color.copy(this.originalColor)},this.onHoverStateChange=function(t){if(this.hoverChildren||this.eventListener===t.target){var e=this.srcColor;this.srcColor=this.destColor,this.destColor=e;var e=this.srcDuration;this.srcDuration=this.destDuration,this.destDuration=e,this.duration=this.destDuration,this.progress=1-this.progress,this.elapsedTime=this.duration*this.progress}}},altspaceutil.behaviors.HoverMaterialOpacity=function(t){t=t||{},this.type="HoverMaterialOpacity",this.awake=function(e){this.opacity=t.opacity||1,this.beginDuration=t.beginDuration||75,this.endDuration=t.endDuration||75,this.revertOnDispose=void 0===t.revertOnDispose||t.revertOnDispose,this.hoverChildren=void 0===t.hoverChildren||t.hoverChildren,this.object3d=e,this.eventListener=t.eventListener||this.object3d,this.material=t.material||this.object3d.material,this.originalOpacity=this.material.opacity,this.srcOpacity=THREE.Math.clamp(this.originalOpacity+this.opacity,0,1),this.destOpacity=this.originalOpacity,this.srcDuration=this.beginDuration,this.destDuration=this.endDuration,this.duration=this.destDuration,this.progress=1,this.elapsedTime=this.duration,this.eventListener.addEventListener("cursorenter",this.onHoverStateChange.bind(this)),this.eventListener.addEventListener("cursorleave",this.onHoverStateChange.bind(this))},this.update=function(t){this.progress<1&&(this.elapsedTime+=t,this.elapsedTime=THREE.Math.clamp(this.elapsedTime,0,this.duration),this.progress=THREE.Math.clamp(this.elapsedTime/this.duration,0,1),this.material.opacity=THREE.Math.lerp(this.srcOpacity,this.destOpacity,this.progress))},this.dispose=function(){this.eventListener.removeEventListener("cursorenter",this.onHoverStateChange.bind(this)),this.eventListener.removeEventListener("cursorleave",this.onHoverStateChange.bind(this)),this.revertOnDispose&&(this.material.opacity=this.originalOpacity)},this.onHoverStateChange=function(t){if(this.hoverChildren||this.eventListener===t.target){var e=this.srcOpacity;this.srcOpacity=this.destOpacity,this.destOpacity=e;var e=this.srcDuration;this.srcDuration=this.destDuration,this.destDuration=e,this.duration=this.destDuration,this.progress=1-this.progress,this.elapsedTime=this.duration*this.progress}}},altspaceutil.behaviors.NativeTextMaterial=function(t){t=t||{},this.type="NativeTextMaterial",this.awake=function(e){this.object3d=e,this.component=this.object3d.getBehaviorByType("n-text"),this.material=t.material||this.object3d.material||new THREE.MeshBasicMaterial({transparent:!0}),this.hasColor=void 0===t.color||t.color,this.hasOpacity=void 0===t.opacity||t.opacity},this.update=function(t){this.removeMaterialTags(),this.component.data.text=this.getMaterialTags()+this.component.data.text},this.dispose=function(){this.removeMaterialTags()},this.removeMaterialTags=function(){var t=this.component.data.text.indexOf('<link id="n-text-material">'),e=t>=0?this.component.data.text.indexOf("</link>",t):-1;t>=0&&e>=0&&(this.component.data.text=this.component.data.text.slice(0,t)+this.component.data.text.slice(e+7))},this.getMaterialTags=function(){var t='<link id="n-text-material">';return this.hasColor?t+="<color=#"+this.getColorHexString()+this.getOpacityHexString()+">":this.hasOpacity&&(t+="<alpha=#"+this.getOpacityHexString()+">"),t+="</link>"},this.getColorHexString=function(){return this.material.color.getHexString()},this.getOpacityHexString=function(){var t=(+Math.floor(this.hasOpacity&&this.material.transparent?255*this.material.opacity:255)).toString(16).toUpperCase();return t.length<2&&(t="0"+t),t}},window.AFRAME&&(AFRAME.components["n-text-material"]&&delete AFRAME.components["n-text-material"],AFRAME.registerComponent("n-text-material",{dependencies:["n-text"],schema:{material:{type:"selector"},color:{type:"boolean",default:!0},opacity:{type:"boolean",default:!0}},init:function(){this.component=this.el.getAttribute("n-text"),this.material=this.data.material?this.data.material.object3DMap.mesh.material:this.el.object3DMap.mesh.material},remove:function(){this.removeMaterialTags()},tick:function(t){this.removeMaterialTags(),this.el.setAttribute("n-text","text",this.getMaterialTags()+this.component.text)},removeMaterialTags:function(){var t=this.component.text.indexOf('<link id="n-text-material">'),e=t>=0?this.component.text.indexOf("</link>",t):-1;t>=0&&e>=0&&(this.component.text=this.component.text.slice(0,t)+this.component.text.slice(e+7))},getMaterialTags:function(){var t='<link id="n-text-material">';return this.data.color?t+="<color=#"+this.getColorHexString()+this.getOpacityHexString()+">":this.data.opacity&&(t+="<alpha=#"+this.getOpacityHexString()+">"),t+="</link>"},getColorHexString:function(){return this.material.color.getHexString()},getOpacityHexString:function(){var t=(+Math.floor(this.data.opacity&&this.material.transparent?255*this.material.opacity:255)).toString(16).toUpperCase();return t.length<2&&(t="0"+t),t}}));
//# sourceMappingURL=altspaceutil.min.js.map