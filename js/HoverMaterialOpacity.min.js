"use strict";window.altspaceutil=window.altspaceutil||{},altspaceutil.behaviors=altspaceutil.behaviors||{},altspaceutil.addNativeEventListener=function(e,t){return altspace.inClient&&altspace._internal&&altspace._internal.couiEngine?altspace._internal.couiEngine.on(e,t):null},altspaceutil.removeNativeEventListener=function(e,t){altspace.inClient&&altspace._internal&&altspace._internal.couiEngine&&altspace._internal.couiEngine.off(e,t)},altspaceutil.removeAllNativeEventListeners=function(e){altspace.inClient&&altspace._internal&&altspace._internal.couiEngine&&altspace._internal.couiEngine.events[e]&&delete altspace._internal.couiEngine.events[e]},altspaceutil.getObject3DById=function(e){return altspace.inClient&&altspace._internal?altspace._internal.getObject3DById(e):null},altspaceutil.getThreeJSScene=function(){return altspace.inClient&&altspace._internal?altspace._internal.getThreeJSScene():null},altspaceutil.expandSerializationBuffer=function(e){altspace.inClient&&altspace._internal&&altspace._internal.ScratchThriftBuffer&&e>0&&altspace._internal.ScratchThriftBuffer.grow(e)},altspaceutil.profileSerializationBuffer=function(e){altspace.inClient&&altspace._internal&&altspace._internal.ScratchThriftBuffer&&(altspace._internal.ScratchThriftBuffer.profile=void 0===e||e)},altspaceutil.isMobileApp=function(e){return/mobile/i.test(navigator.userAgent)},altspaceutil.getFullspaceEnclosure=function(){return new Promise(function(e,t){altspace.getEnclosure().then(function(i){i.requestFullspace().then(function(){i.addEventListener("fullspacechange",function(){i.fullspace||i.requestFullspace().catch(function(){t("enclosure.requestFullspace() after fullspacechange event failed")})}),e(i)}).catch(function(){t("enclosure.requestFullspace() failed")})}).catch(function(){t("altspace.getEnclosure() failed")})})},altspaceutil.getAbsoluteURL=function(e){return new URL(e,window.location).toString()},altspaceutil.getBasePath=function(e){return e.split("/").slice(0,-1).join("/")+"/"},altspaceutil.loadTexture=function(e,t){if(altspace.inClient)return new THREE.Texture({src:altspaceutil.getAbsoluteURL(e)});t=Object.assign({crossOrigin:"anonymous"},t);var i=new THREE.TextureLoader;return"anonymous"!==t.crossOrigin&&i.setCrossOrigin(t.crossOrigin),void 0!==t.withCredentials&&i.setWithCredentials(t.withCredentials),void 0!==t.path&&i.setPath(t.path),i.load(e)},altspaceutil.setCursorCollider=function(e,t,i){e&&(i?e.traverse(e=>{e.userData.altspace||(e.userData.altspace={}),e.userData.altspace.collider||(e.userData.altspace.collider={}),e.userData.altspace.collider.enabled=t}):(e.userData.altspace||(e.userData.altspace={}),e.userData.altspace.collider||(e.userData.altspace.collider={}),e.userData.altspace.collider.enabled=t))},altspaceutil.isCursorCollider=function(e){return!!e&&(!e.userData.altspace||!e.userData.altspace.collider||void 0===e.userData.altspace.enabled||e.userData.altspace.enabled)},altspaceutil.manageBehavior=function(e,t){e.__isManaged=!0,t.__resetManagedBehavior||t.addEventListener("removed",t.__resetManagedBehavior=function(){t.__resetManagedBehavior&&(t.removeEventListener("removed",t.__resetManagedBehavior),t.__resetManagedBehavior=null),t.traverse(function(e){if(e.__behaviorList)for(var t of e.__behaviorList)if(t.__isInitialized&&t.__isManaged)try{t.dispose&&t.dispose.call(t,e),t.__isInitialized=!1}catch(i){console.group(),(console.error||console.log).call(console,i.stack||i),console.log("[Behavior]"),console.log(t),console.log("[Object3D]"),console.log(e),console.groupEnd()}})})},altspaceutil.unmanageBehavior=function(e,t){e.__isManaged=!1},altspaceutil.cloneWithBehaviors=function(e,t){var i=e.clone(!1);if(e.__behaviorList&&e.__behaviorList.length>0)for(var a of e.__behaviorList)try{if(a.clone){var s=a.clone.call(a,i,e);s&&(i.__behaviorList=i.__behaviorList||[],i.__behaviorList.push(s))}}catch(t){console.group(),(console.error||console.log).call(console,t.stack||t),console.log("[Behavior]"),console.log(a),console.log("[Object3D]"),console.log(e),console.groupEnd()}if(void 0===t||t)for(var n of e.children)i.add(n.cloneWithBehaviors(!0));return i},altspaceutil.behaviors.HoverMaterialOpacity=function(e){e=e||{},this.type="HoverMaterialOpacity",this.awake=function(t){this.opacity=e.opacity||1,this.beginDuration=e.beginDuration||75,this.endDuration=e.endDuration||75,this.revertOnDispose=void 0===e.revertOnDispose||e.revertOnDispose,this.hoverChildren=void 0===e.hoverChildren||e.hoverChildren,this.object3d=t,this.eventListener=e.eventListener||this.object3d,this.material=e.material||this.object3d.material,this.originalOpacity=this.material.opacity,this.srcOpacity=THREE.Math.clamp(this.originalOpacity+this.opacity,0,1),this.destOpacity=this.originalOpacity,this.srcDuration=this.beginDuration,this.destDuration=this.endDuration,this.duration=this.destDuration,this.progress=1,this.elapsedTime=this.duration,this.eventListener.addEventListener("cursorenter",this.onHoverStateChange.bind(this)),this.eventListener.addEventListener("cursorleave",this.onHoverStateChange.bind(this))},this.update=function(e){this.progress<1&&(this.elapsedTime+=e,this.elapsedTime=THREE.Math.clamp(this.elapsedTime,0,this.duration),this.progress=THREE.Math.clamp(this.elapsedTime/this.duration,0,1),this.material.opacity=THREE.Math.lerp(this.srcOpacity,this.destOpacity,this.progress))},this.dispose=function(){this.eventListener.removeEventListener("cursorenter",this.onHoverStateChange.bind(this)),this.eventListener.removeEventListener("cursorleave",this.onHoverStateChange.bind(this)),this.revertOnDispose&&(this.material.opacity=this.originalOpacity)},this.onHoverStateChange=function(e){if(this.hoverChildren||this.eventListener===e.target){var t=this.srcOpacity;this.srcOpacity=this.destOpacity,this.destOpacity=t;var t=this.srcDuration;this.srcDuration=this.destDuration,this.destDuration=t,this.duration=this.destDuration,this.progress=1-this.progress,this.elapsedTime=this.duration*this.progress}}};