"use strict";window.altspaceutil=window.altspaceutil||{},altspaceutil.behaviors=altspaceutil.behaviors||{},altspaceutil.addNativeEventListener=function(t,e){return altspace.inClient&&altspace._internal&&altspace._internal.couiEngine?altspace._internal.couiEngine.on(t,e):null},altspaceutil.removeNativeEventListener=function(t,e){altspace.inClient&&altspace._internal&&altspace._internal.couiEngine&&altspace._internal.couiEngine.off(t,e)},altspaceutil.removeAllNativeEventListeners=function(t){altspace.inClient&&altspace._internal&&altspace._internal.couiEngine&&altspace._internal.couiEngine.events[t]&&delete altspace._internal.couiEngine.events[t]},altspaceutil.getObject3DById=function(t){return altspace.inClient&&altspace._internal?altspace._internal.getObject3DById(t):null},altspaceutil.getThreeJSScene=function(t){return altspace.inClient&&altspace._internal?altspace._internal.getThreeJSScene():null},altspaceutil.getAbsoluteURL=function(t){if(t&&!t.startsWith("http"))if(t.startsWith("/"))t=location.origin+t;else{var e=location.pathname;e.endsWith("/")||(e=location.pathname.split("/").slice(0,-1).join("/")+"/"),t=location.origin+e+t}return t},altspaceutil.getBasePath=function(t){return t.split("/").slice(0,-1).join("/")+"/"},altspaceutil.manageBehavior=function(t,e){t.__isManaged=!0,e.__resetManagedBehavior||e.addEventListener("removed",e.__resetManagedBehavior=function(){e.__resetManagedBehavior&&(e.removeEventListener("removed",e.__resetManagedBehavior),e.__resetManagedBehavior=null),e.traverse(function(t){if(t.__behaviorList)for(var e of t.__behaviorList)if(e.__isInitialized&&e.__isManaged)try{e.dispose&&e.dispose.call(e,t),e.__isInitialized=!1}catch(i){console.group(),(console.error||console.log).call(console,i.stack||i),console.log("[Behavior]"),console.log(e),console.log("[Object3D]"),console.log(t),console.groupEnd()}})})},altspaceutil.unmanageBehavior=function(t,e){t.__isManaged=!1},altspaceutil.cloneWithBehaviors=function(t,e){var i=t.clone(!1);if(t.__behaviorList&&t.__behaviorList.length>0)for(var s of t.__behaviorList)try{if(s.clone){var a=s.clone.call(s,i,t);a&&(i.__behaviorList=i.__behaviorList||[],i.__behaviorList.push(a))}}catch(e){console.group(),(console.error||console.log).call(console,e.stack||e),console.log("[Behavior]"),console.log(s),console.log("[Object3D]"),console.log(t),console.groupEnd()}if(void 0===e||e)for(var r of t.children)i.add(r.cloneWithBehaviors(!0));return i},altspaceutil.behaviors.TransformControls=function(t){this.type="TransformControls",this.config=Object.assign({controlType:"none",showButtons:!1,followTarget:!0,target:null,scale:1,allowNegativeScale:!1},t),this.awake=function(t,e){this.object3d=t,this.scene=e,this.target=this.config.target||this.object3d,altspaceutil.manageBehavior(this,this.object3d),this.objectState={},this.controls={none:null,position:new THREE.Group,rotate:new THREE.Group,scale:new THREE.Group},this.selectedControlType=this.config.controlType,this.selectedControl=null,this.controlTypeButtons=null,this.colorMaterials={red:new THREE.MeshBasicMaterial({color:16711680}),green:new THREE.MeshBasicMaterial({color:65280}),blue:new THREE.MeshBasicMaterial({color:255}),yellow:new THREE.MeshBasicMaterial({color:16776960}),orange:new THREE.MeshBasicMaterial({color:16763904})},this.scene.addEventListener("cursormove",function(t){if(!this.selectedControl)return void(this.hoveredAxis&&(this.hoveredAxis.traverse(function(t){t.userData.material&&(t.material=t.userData.material,delete t.userData.material,t.geometry.uvsNeedUpdate=!0)}.bind(this)),this.hoveredAxis=null));this.raycaster.set(t.ray.origin,t.ray.direction);var e=this.raycaster.intersectObject(this.selectedControl,!0)[0];!this.hoveredAxis||e&&this.hoveredAxis===e.object||(this.dragAxis||this.hoveredAxis.traverse(function(t){t.userData.material&&(t.material=t.userData.material,delete t.userData.material,t.geometry.uvsNeedUpdate=!0)}.bind(this)),this.hoveredAxis=null),e&&(this.hoveredAxis=e.object,this.dragAxis||this.hoveredAxis.traverse(function(t){!t.userData.material&&t.material.visible&&(t.userData.material=t.material,t.material=this.colorMaterials.orange,t.geometry.uvsNeedUpdate=!0)}.bind(this)))}.bind(this));var i=function(t,e,i){return Object.assign(new THREE.Mesh(new THREE.BoxBufferGeometry(i.width,i.height,i.depth),this.colorMaterials[e]),{name:t})}.bind(this),s=function(t,e,i,s,a){var r=Object.assign(new THREE.Mesh(new THREE.BoxGeometry(i.width,i.height,i.depth),this.colorMaterials[e]),{name:t});r.position.set(s.x,s.y,s.z),r.rotation.set(a.x,a.y,a.z);var o=new THREE.Object3D;o.position.set(i.width/2,0,0),o.rotation.set(0,0,-Math.PI/2),o.updateMatrix();var n=new THREE.CylinderGeometry(0,2*i.depth,4*i.depth,4,1,!1,Math.PI/4);return n.applyMatrix(o.matrix),r.geometry.merge(n),r.geometry=(new THREE.BufferGeometry).fromGeometry(r.geometry),r}.bind(this),a=function(t,e,i,s){var a=Object.assign(new THREE.Mesh(new THREE.RingBufferGeometry(.8*i.radius,1.5*i.radius,10,1),Object.assign(this.colorMaterials[e].clone(),{side:THREE.DoubleSide,visible:!1})),{name:t});a.rotation.set(s.x,s.y,s.z);var r=Object.assign(new THREE.Mesh(new THREE.TorusBufferGeometry(i.radius,i.tube,i.radialSegments,i.tubularSegments),this.colorMaterials[e]),{name:t});return a.add(r),a}.bind(this),r=function(t,e,i,s,a){var r=Object.assign(new THREE.Mesh(new THREE.BoxGeometry(i.width,i.height,i.depth),this.colorMaterials[e]),{name:t});r.position.set(s.x,s.y,s.z),r.rotation.set(a.x,a.y,a.z);var o=new THREE.Object3D;o.position.set(i.width/2,0,0),o.rotation.set(0,0,-Math.PI/2),o.updateMatrix();var n=new THREE.BoxGeometry(2*i.depth,2*i.depth,2*i.depth);return n.applyMatrix(o.matrix),r.geometry.merge(n),r.geometry=(new THREE.BufferGeometry).fromGeometry(r.geometry),r}.bind(this);if(this.controls.position.name="position",this.controls.position.add(i("xyz","yellow",{width:.15,height:.15,depth:.15}).add(s("x","red",{width:1,height:.05,depth:.05},{x:.5,y:0,z:0},{x:0,y:0,z:0}),s("y","green",{width:1,height:.05,depth:.05},{x:0,y:.5,z:0},{x:0,y:0,z:Math.PI/2}),s("z","blue",{width:1,height:.05,depth:.05},{x:0,y:0,z:.5},{x:Math.PI/2,y:0,z:Math.PI/2}))),this.controls.rotate.name="rotate",this.controls.rotate.add(i("xyz","yellow",{width:.05,height:.05,depth:.05}).add(a("x","red",{radius:.7,tube:.03,radialSegments:8,tubularSegments:28},{x:0,y:Math.PI/2,z:0}),a("y","green",{radius:.7,tube:.03,radialSegments:8,tubularSegments:28},{x:Math.PI/2,y:0,z:0}),a("z","blue",{radius:.7,tube:.03,radialSegments:8,tubularSegments:28},{x:0,y:0,z:0}))),this.controls.scale.name="scale",this.controls.scale.add(i("xyz","yellow",{width:.15,height:.15,depth:.15}).add(r("x","red",{width:1,height:.05,depth:.05},{x:.5,y:0,z:0},{x:0,y:0,z:0}),r("y","green",{width:1,height:.05,depth:.05},{x:0,y:.5,z:0},{x:0,y:0,z:Math.PI/2}),r("z","blue",{width:1,height:.05,depth:.05},{x:0,y:0,z:.5},{x:Math.PI/2,y:0,z:Math.PI/2}))),this.onDragBegin=function(t){if(this.dragAxis=null,this.selectedControl){this.raycaster.set(t.ray.origin,t.ray.direction);var e=this.raycaster.intersectObject(this.selectedControl,!0)[0];if(e){this.dragAxis=e.object.name,this.hoveredAxis&&this.hoveredAxis.traverse(function(t){t.userData.material&&(t.material=t.userData.material,delete t.userData.material,t.geometry.uvsNeedUpdate=!0)}.bind(this));var i=this.selectedControl.getObjectByName(this.dragAxis);i&&i.traverse(function(t){!t.userData.material&&t.material.visible&&(t.userData.material=t.material,t.material=this.colorMaterials.orange,t.geometry.uvsNeedUpdate=!0)}.bind(this)),this.scene.updateMatrixWorld(),this.dragPointBegin=e.point.clone(),this.controlbase.removeEventListener("cursordown",this.onDragBegin),this.scene.addEventListener("cursorup",this.onDragEnd),this.scene.addEventListener("cursormove",this.onDragMove),this.intersector.quaternion.copy(this.selectedControl.getObjectByName(this.dragAxis).quaternion),"xyz"===this.dragAxis&&(this.originIntersectors.traverse(function(t){t instanceof THREE.Mesh&&(t.visible=!0)}),e=this.raycaster.intersectObjects([this.originIntersectors.children[0],this.originIntersectors.children[1],this.originIntersectors.children[2]],!0)[0],this.originIntersector=e&&e.object?e.object:this.intersector,e&&(this.dragPointBegin=e.point.clone()),this.originIntersectors.traverse(function(t){t instanceof THREE.Mesh&&(t.visible=!1)})),this.dispatchDragBeginEvent()}}}.bind(this),this.onDragMove=function(t){if(!this.selectedControl)return this.scene.removeEventListener("cursorup",this.onDragEnd),this.scene.removeEventListener("cursormove",this.onDragMove),this.controlbase.addEventListener("cursordown",this.onDragBegin),void(this.dragAxis=null);var e;if(this.raycaster.set(t.ray.origin,t.ray.direction),"xyz"===this.dragAxis?(this.originIntersector.visible=!0,e=this.raycaster.intersectObject(this.originIntersector,!0)[0],this.originIntersector.visible=!1):(this.intersector.quaternion.copy(this.selectedControl.getObjectByName(this.dragAxis).quaternion),this.intersector.visible=!0,e=this.raycaster.intersectObject(this.intersector,!0)[0],this.intersector.visible=!1),e){var i=this.dragPointBegin.clone().sub(this.object3d.position),s=e.point.clone().sub(this.object3d.position),a=e.point.clone().sub(this.dragPointBegin);this.dragPointBegin=e.point.clone();var r=new THREE.Vector3;if("position"===this.selectedControlType){switch(this.dragAxis){case"x":case"y":case"z":r[this.dragAxis]+=a[this.dragAxis];break;case"xyz":"x"===this.originIntersector.name?r.set(a.x,a.y,0):"y"===this.originIntersector.name?r.set(0,a.y,a.z):"z"===this.originIntersector.name?r.set(a.x,0,a.z):r.copy(a)}this.target.position.add(r)}else if("scale"===this.selectedControlType)switch(this.dragAxis){case"x":case"y":case"z":r[this.dragAxis]+=a[this.dragAxis],this.target.scale.add(r),(void 0===this.target.scale[this.dragAxis]||isNaN(this.target.scale[this.dragAxis])||!this.config.allowNegativeScale&&this.target.scale[this.dragAxis]<0)&&(this.target.scale[this.dragAxis]=Number.EPSILON);break;default:var o=a.x;Math.abs(a.y)>Math.abs(o)&&(o=a.y),Math.abs(a.z)>Math.abs(o)&&(o=a.z),r.setScalar(o),this.target.scale.add(r),(void 0===this.target.scale.x||isNaN(this.target.scale.x)||!this.config.allowNegativeScale&&this.target.scale.x<0)&&(this.target.scale.x=Number.EPSILON),(void 0===this.target.scale.y||isNaN(this.target.scale.y)||!this.config.allowNegativeScale&&this.target.scale.y<0)&&(this.target.scale.y=Number.EPSILON),(void 0===this.target.scale.z||isNaN(this.target.scale.z)||!this.config.allowNegativeScale&&this.target.scale.z<0)&&(this.target.scale.z=Number.EPSILON)}else if("rotate"===this.selectedControlType){switch(this.dragAxis){case"x":var n=Math.atan2(s.z,s.y)-Math.atan2(i.z,i.y);r[this.dragAxis]+=n;break;case"y":var n=Math.atan2(s.x,s.z)-Math.atan2(i.x,i.z);r[this.dragAxis]+=n;break;case"z":var n=Math.atan2(s.y,s.x)-Math.atan2(i.y,i.x);r[this.dragAxis]+=n}this.target.rotation[this.dragAxis]+=r[this.dragAxis]}this.updateTransform(),this.dispatchDragMoveEvent(r)}}.bind(this),this.onDragEnd=function(t){this.scene.removeEventListener("cursorup",this.onDragEnd),this.scene.removeEventListener("cursormove",this.onDragMove),this.controlbase.addEventListener("cursordown",this.onDragBegin);var e=this.dragAxis;if(this.dragAxis=null,this.selectedControl&&e){var i=this.selectedControl.getObjectByName(e);i&&i.traverse(function(t){t.userData.material&&(t.material=t.userData.material,delete t.userData.material,t.geometry.uvsNeedUpdate=!0)}.bind(this)),this.hoveredAxis&&this.hoveredAxis.traverse(function(t){!t.userData.material&&t.material.visible&&(t.userData.material=t.material,t.material=this.colorMaterials.orange,t.geometry.uvsNeedUpdate=!0)}.bind(this))}if(this.selectedControl){var s;if(this.raycaster.set(t.ray.origin,t.ray.direction),"xyz"===e?(this.originIntersector.visible=!0,s=this.raycaster.intersectObject(this.originIntersector,!0)[0],this.originIntersector.visible=!1):(this.intersector.quaternion.copy(this.selectedControl.getObjectByName(e).quaternion),this.intersector.visible=!0,s=this.raycaster.intersectObject(this.intersector,!0)[0],this.intersector.visible=!1),s){var a=this.dragPointBegin.clone().sub(this.object3d.position),r=s.point.clone().sub(this.object3d.position),o=s.point.clone().sub(this.dragPointBegin);this.dragPointBegin=s.point.clone();var n=new THREE.Vector3;if("position"===this.selectedControlType){switch(e){case"x":case"y":case"z":n[e]+=o[e];break;case"xyz":"x"===this.originIntersector.name?n.set(o.x,o.y,0):"y"===this.originIntersector.name?n.set(0,o.y,o.z):"z"===this.originIntersector.name?n.set(o.x,0,o.z):n.copy(o)}this.target.position.add(n)}else if("scale"===this.selectedControlType)switch(e){case"x":case"y":case"z":n[e]+=o[e],this.target.scale.add(n),(void 0===this.target.scale[e]||isNaN(this.target.scale[e])||!this.config.allowNegativeScale&&this.target.scale[e]<0)&&(this.target.scale[e]=Number.EPSILON);break;default:var l=o.x;Math.abs(o.y)>Math.abs(l)&&(l=o.y),Math.abs(o.z)>Math.abs(l)&&(l=o.z),n.setScalar(l),this.target.scale.add(n),(void 0===this.target.scale.x||isNaN(this.target.scale.x)||!this.config.allowNegativeScale&&this.target.scale.x<0)&&(this.target.scale.x=Number.EPSILON),(void 0===this.target.scale.y||isNaN(this.target.scale.y)||!this.config.allowNegativeScale&&this.target.scale.y<0)&&(this.target.scale.y=Number.EPSILON),(void 0===this.target.scale.z||isNaN(this.target.scale.z)||!this.config.allowNegativeScale&&this.target.scale.z<0)&&(this.target.scale.z=Number.EPSILON)}else if("rotate"===this.selectedControlType){switch(e){case"x":var c=Math.atan2(r.z,r.y)-Math.atan2(a.z,a.y);n[e]+=c;break;case"y":var c=Math.atan2(r.x,r.z)-Math.atan2(a.x,a.z);n[e]+=c;break;case"z":var c=Math.atan2(r.y,r.x)-Math.atan2(a.y,a.x);n[e]+=c}this.target.rotation[e]+=n[e]}this.updateTransform(),this.dispatchDragMoveEvent(n),this.dispatchDragEndEvent(e)}}}.bind(this),this.config.showButtons){var o=function(t){this.buttonDownControlType=t.target.name}.bind(this),n=function(t){t.target.name===this.buttonDownControlType&&this.setActiveControl(this.buttonDownControlType===this.selectedControlType?"none":this.buttonDownControlType)}.bind(this);this.controlTypeButtons=new THREE.Group,this.controlTypeButtons.position.set(.5,1,0);var l=new THREE.BoxBufferGeometry(.2,.2,.2),c=Object.assign(new THREE.Mesh(l,Object.assign(this.colorMaterials.red.clone(),{transparent:!0,opacity:.2})),{name:"position"}),h=this.controls.position.clone();h.position.set(-.025,-.025,-.025),h.scale.multiplyScalar(.1),c.add(h),c.addEventListener("cursordown",o),c.addEventListener("cursorup",n);var d=Object.assign(new THREE.Mesh(l,Object.assign(this.colorMaterials.green.clone(),{transparent:!0,opacity:.2})),{name:"rotate"}),g=this.controls.rotate.clone();g.scale.multiplyScalar(.1),d.add(g),d.position.set(.25,0,0),d.addEventListener("cursordown",o),d.addEventListener("cursorup",n);var u=Object.assign(new THREE.Mesh(l,Object.assign(this.colorMaterials.blue.clone(),{transparent:!0,opacity:.2})),{name:"scale"}),v=this.controls.scale.clone();v.position.set(-.025,-.025,-.025),v.scale.multiplyScalar(.1),u.add(v),u.position.set(.5,0,0),u.addEventListener("cursordown",o),u.addEventListener("cursorup",n),this.controlTypeButtons.add(c,d,u)}this.raycaster=new THREE.Raycaster;var b=new THREE.PlaneGeometry(1e5,1e5);this.intersector=Object.assign(new THREE.Mesh(b,new THREE.MeshBasicMaterial({color:16711935,side:THREE.DoubleSide,visible:!1})),{visible:!1}),this.originIntersectors=new THREE.Group,this.originIntersectors.add(Object.assign(new THREE.Mesh(b,new THREE.MeshBasicMaterial({color:16711680,side:THREE.DoubleSide,visible:!1})),{name:"x",visible:!1}),Object.assign(new THREE.Mesh(b,new THREE.MeshBasicMaterial({color:65280,side:THREE.DoubleSide,visible:!1})),{name:"y",visible:!1}),Object.assign(new THREE.Mesh(b,new THREE.MeshBasicMaterial({color:255,side:THREE.DoubleSide,visible:!1})),{name:"z",visible:!1})),this.originIntersectors.children[1].rotation.y=Math.PI/2,this.originIntersectors.children[2].rotation.x=Math.PI/2,this.controlbase=new THREE.Group,this.controlbase.add(this.controls.position,this.controls.rotate,this.controls.scale,this.intersector,this.originIntersectors),this.controlbase.traverse(function(t){t.userData.isTransformControl=!0,t.visible=!1}),this.controlbase.addEventListener("cursordown",this.onDragBegin),this.scene.add(this.controlbase),this.controlbase.scale.setScalar(this.config.scale),this.controlTypeButtons&&this.controlbase.add(this.controlTypeButtons),this.setActiveControl(this.selectedControlType)},this.dispatchDragMoveEvent=function(t){if(0!==t.x||0!==t.y||0!==t.z){var e=this;this.object3d.dispatchEvent({type:"transform-controls-dragmove",detail:{behavior:e,parent:e.object3d,transformTarget:e.target,transformType:e.selectedControlType,transformAxis:e.dragAxis,transformDelta:t},bubbles:!0,target:e.object3d})}},this.dispatchDragBeginEvent=function(){var t=this;this.object3d.dispatchEvent({type:"transform-controls-dragbegin",detail:{behavior:t,parent:t.object3d,transformTarget:t.target,transformType:t.selectedControlType,transformAxis:t.dragAxis},bubbles:!0,target:t.object3d})},this.dispatchDragEndEvent=function(t){var e=this;this.object3d.dispatchEvent({type:"transform-controls-dragend",detail:{behavior:e,parent:e.object3d,transformTarget:e.target,transformType:e.selectedControlType,transformAxis:t},bubbles:!0,target:e.object3d})},this.updateTransform=function(){this.scene.updateMatrixWorld(),this.controlbase.position.copy((this.config.followTarget?this.target:this.object3d).getWorldPosition())},this.update=function(){this.updateTransform(),this.target.traverse(function(t){t.userData.isTransformControl||t.userData.altspace&&t.userData.altspace.collider&&!t.userData.altspace.collider.enabled||(this.objectState[t.uuid]=Object.assign(this.objectState[t.uuid]||{},{collider:{enabled:!0}}),t.userData.altspace={collider:{enabled:!1}})}.bind(this))},this.dispose=function(){this.setActiveControl("none"),this.intersector&&this.intersector.parent&&this.intersector.parent.remove(this.intersector),this.controlTypeButtons&&this.controlTypeButtons.parent&&this.controlTypeButtons.parent.remove(this.controlTypeButtons),this.target&&this.target.traverse(function(t){!t.userData.isTransformControl&&this.objectState[t.uuid]&&(t.userData.altspace=Object.assign(t.userData.altspace||{},{collider:this.objectState[t.uuid].collider}),delete this.objectState[t.uuid])}.bind(this)),this.object3d=null,this.target=null,this.scene=null,this.objectState=null,this.controls=null,this.selectedControlType=null,this.selectedControl=null,this.colorMaterials=null,this.controlbase=null,this.controlTypeButtons=null,this.buttonDownControlType=null,this.intersector=null,this.raycaster=null,this.originIntersectors=null,this.originIntersector=null,this.dragPointBegin=null,this.dragAxis=null,this.hoveredAxis=null,this.onDragBegin=null,this.onDragEnd=null,this.onDragMove=null},this.setActiveControl=function(t){if(!this.controls&&["none","position","rotate","scale"].indexOf(t)>=0)return void(this.config.controlType=t);if(this.controls&&this.object3d&&this.target&&this.controls.hasOwnProperty(t)){if(this.selectedControl){if(t===this.selectedControl.name)return;this.selectedControl.traverse(function(t){t.visible=!1})}else if("none"===t)return;this.selectedControl=this.controls[t],this.selectedControlType=this.selectedControl?this.selectedControl.name:"none",this.selectedControl&&this.selectedControl.traverse(function(t){t.visible=!0}),this.update()}},this.getActiveControl=function(){return this.selectedControlType},this.setTarget=function(t){this.target=this.config.target=t},this.getTarget=function(){return this.target}},window.AFRAME&&AFRAME.registerComponent("altspace-transform-controls",{schema:{controlType:{type:"string",default:"none"},showButtons:{type:"boolean",default:!1},followTarget:{type:"boolean",default:!0},target:{type:"selector"},scale:{type:"number",default:1},allowNegativeScale:{type:"boolean",default:!1},syncEvents:{type:"boolean",default:!0}},init:function(){if(this.behavior=new altspaceutil.behaviors.TransformControls({controlType:this.data.controlType,showButtons:this.data.showButtons,followTarget:this.data.followTarget,target:this.data.target?this.data.target.object3D:null,scale:this.data.scale,allowNegativeScale:this.data.allowNegativeScale}),this.el.object3D.addBehavior(this.behavior),this.data.syncEvents){var t=function(t){var e=this.el.object3D.getBehaviorByType("TransformControls").getTarget().el;e&&e.components.sync&&e.components.sync.isConnected&&(e.components.sync.takeOwnership(),e.setAttribute("position",e.object3D.position),e.setAttribute("rotation",{x:THREE.Math.radToDeg(e.object3D.rotation.x),y:THREE.Math.radToDeg(e.object3D.rotation.y),z:THREE.Math.radToDeg(e.object3D.rotation.z)}),e.setAttribute("scale",e.object3D.scale))}.bind(this);this.el.object3D.addEventListener("transform-controls-dragbegin",t),this.el.object3D.addEventListener("transform-controls-dragmove",t),this.el.object3D.addEventListener("transform-controls-dragend",t)}},remove:function(){this.behavior&&this.el.object3D.removeBehavior(this.behavior)}});